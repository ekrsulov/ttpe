"use strict";(self.webpackChunkttpe_docs=self.webpackChunkttpe_docs||[]).push([[1694],{5181:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"plugins/catalog/transformation","title":"Transformation Plugin","description":"Purpose: Resize, rotate, and transform selected elements","source":"@site/docs/plugins/catalog/transformation.md","sourceDirName":"plugins/catalog","slug":"/plugins/catalog/transformation","permalink":"/ttpe/docs/plugins/catalog/transformation","draft":false,"unlisted":false,"editUrl":"https://github.com/ekrsulov/ttpe/tree/main/doc/docs/plugins/catalog/transformation.md","tags":[],"version":"current","lastUpdatedBy":"Ernesto Krsulovic","lastUpdatedAt":1762144179000,"frontMatter":{"id":"transformation","title":"Transformation Plugin","sidebar_label":"Transformation"},"sidebar":"docs","previous":{"title":"Shape","permalink":"/ttpe/docs/plugins/catalog/shape"},"next":{"title":"Edit","permalink":"/ttpe/docs/plugins/catalog/edit"}}');var s=a(4848),r=a(8453);const l={id:"transformation",title:"Transformation Plugin",sidebar_label:"Transformation"},i="Transformation Plugin",o={},d=[{value:"Overview",id:"overview",level:2},{value:"Plugin Interaction Flow",id:"plugin-interaction-flow",level:2},{value:"Transform Math Operations",id:"transform-math-operations",level:2},{value:"Handle System",id:"handle-system",level:2},{value:"Handler",id:"handler",level:2},{value:"Keyboard Shortcuts",id:"keyboard-shortcuts",level:2},{value:"UI Contributions",id:"ui-contributions",level:2},{value:"Panels",id:"panels",level:3},{value:"Overlays",id:"overlays",level:3},{value:"Canvas Layers",id:"canvas-layers",level:3},{value:"Public APIs",id:"public-apis",level:2},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Implementation Details",id:"implementation-details",level:2},{value:"Edge Cases &amp; Limitations",id:"edge-cases--limitations",level:2},{value:"Related",id:"related",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"transformation-plugin",children:"Transformation Plugin"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose"}),": Resize, rotate, and transform selected elements"]}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Bounding box with resize handles"}),"\n",(0,s.jsx)(n.li,{children:"Proportional scaling (Shift key)"}),"\n",(0,s.jsx)(n.li,{children:"Center scaling (Alt/Option key)"}),"\n",(0,s.jsx)(n.li,{children:"Rotation handle"}),"\n",(0,s.jsx)(n.li,{children:"Visual rulers and coordinate display"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"plugin-interaction-flow",children:"Plugin Interaction Flow"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant User\n    participant UI as UI/Toolbar\n    participant Store as Canvas Store\n    participant TP as Transform Plugin\n    participant Canvas as Canvas Renderer\n    participant TM as Transform Math\n    \n    Note over User,Canvas: 1. Tool Activation\n    User->>UI: Click Transform Tool\n    UI->>Store: setActivePlugin('transformation')\n    Store->>Store: Update activePlugin\n    Store->>Store: Get selected elements\n    TP->>TM: calculateBoundingBox(elements)\n    TM->>TP: Return bounds + handles\n    Store->>Store: Set transform handles\n    Canvas->>Canvas: Draw bounding box & handles\n    \n    Note over User,Canvas: 2. Resize via Corner Handle\n    User->>Canvas: Click corner handle\n    Canvas->>TP: Internal handle down handling\n    TP->>Store: Set activeHandle = 'corner-se'\n    TP->>Store: Store initial bounds\n    TP->>Store: Check modifier keys\n    \n    User->>Canvas: Drag handle\n    Canvas->>TP: Internal handle move handling\n    TP->>Store: Get activeHandle position\n    TP->>Store: Calculate delta [dx, dy]\n    \n    alt Shift Key (Proportional)\n        TP->>TM: calculateProportionalScale(delta)\n        TM->>TP: Return constrained dimensions\n    else Alt or Option Key (Center)\n        TP->>TM: calculateCenterScale(delta)\n        TM->>TP: Return mirrored dimensions\n    else Normal\n        TP->>TM: calculateFreeScale(delta)\n        TM->>TP: Return free dimensions\n    end\n    \n    TP->>TM: applyTransform(elements, newBounds)\n    TM->>TM: Calculate scale factors\n    TM->>TM: Transform element positions\n    TM->>TM: Transform element dimensions\n    TM->>TP: Return transformed elements\n    \n    TP->>Store: Update elements (preview)\n    Store->>Canvas: Re-render elements\n    Store->>Canvas: Update handle positions\n    TP->>UI: Display dimensions tooltip\n    \n    loop While Dragging\n        Canvas->>TP: handleHandleMove\n        TP->>TM: Calculate transform\n        TM->>Canvas: Update preview\n    end\n    \n    User->>Canvas: Release handle\n    Canvas->>TP: handleHandleUp(event)\n    TP->>Store: Set activeHandle = null\n    TP->>Store: Commit transformed elements\n    Store->>EB: Publish 'elements:transformed'\n    EB->>Store: Add to undo stack\n    EB->>Canvas: Final render\n    \n    Note over User,Canvas: 3. Rotation via Rotation Handle\n    User->>Canvas: Click rotation handle\n    Canvas->>TP: handleRotationDown(event)\n    TP->>Store: Set activeHandle = 'rotation'\n    TP->>TM: Calculate center point\n    TM->>TP: Return rotation center\n    \n    User->>Canvas: Drag rotation handle\n    Canvas->>TP: handleRotationMove(event)\n    TP->>TM: calculateAngle(center, mousePos)\n    TM->>TP: Return angle in degrees\n    \n    alt Shift Key (15\xb0 increments)\n        TP->>TP: Snap angle to 15\xb0 intervals\n    else Normal\n        TP->>TP: Use exact angle\n    end\n    \n    TP->>TM: rotateElements(elements, angle, center)\n    TM->>TM: Apply rotation matrix\n    TM->>TP: Return rotated elements\n    \n    TP->>Store: Update elements (preview)\n    Store->>Canvas: Re-render rotated elements\n    TP->>UI: Display angle tooltip\n    \n    User->>Canvas: Release rotation handle\n    Canvas->>TP: handleRotationUp(event)\n    TP->>Store: Commit rotation\n    Store->>EB: Publish 'elements:rotated'\n    EB->>Store: Add to undo stack\n    \n    Note over User,Canvas: 4. Edge Handle (Width/Height only)\n    User->>Canvas: Drag top edge handle\n    Canvas->>TP: handleEdgeMove(event)\n    TP->>TM: scaleHeight(delta)\n    TM->>TP: Return scaled elements\n    TP->>Store: Update elements\n    Store->>Canvas: Re-render\n    \n    Note over User,Canvas: 5. Direct Input via Panel\n    User->>UI: Enter width value in panel\n    UI->>TP: setWidth(newWidth)\n    TP->>TM: scaleToWidth(elements, newWidth)\n    TM->>TP: Return scaled elements\n    TP->>Store: updateElements(scaled)\n    Store->>Canvas: Re-render"}),"\n",(0,s.jsx)(n.h2,{id:"transform-math-operations",children:"Transform Math Operations"}),"\n",(0,s.jsx)(n.mermaid,{value:"flowchart TD\n    A[Transform Operation] --\x3e B{Operation Type?}\n    \n    B --\x3e|Resize| C[Scale Transform]\n    B --\x3e|Rotate| D[Rotation Transform]\n    B --\x3e|Move| E[Translation Transform]\n    \n    C --\x3e C1{Modifier Keys?}\n    C1 --\x3e|Shift| C2[Proportional Scale]\n    C1 --\x3e|Alt| C3[Center Scale]\n    C1 --\x3e|None| C4[Free Scale]\n    \n    C2 --\x3e F1[Maintain Aspect Ratio]\n    C3 --\x3e F2[Scale from Center]\n    C4 --\x3e F3[Independent Width/Height]\n    \n    D --\x3e D1{Snap Angle?}\n    D1 --\x3e|Shift| D2[15\xb0 Increments]\n    D1 --\x3e|None| D3[Free Rotation]\n    \n    D2 --\x3e G1[Round to nearest 15\xb0]\n    D3 --\x3e G2[Exact angle]\n    \n    E --\x3e E1[Calculate Delta]\n    E1 --\x3e E2[Apply to all elements]\n    \n    F1 --\x3e H[Calculate Transform Matrix]\n    F2 --\x3e H\n    F3 --\x3e H\n    G1 --\x3e H\n    G2 --\x3e H\n    E2 --\x3e H\n    \n    H --\x3e I[Apply to Elements]\n    I --\x3e J[Update Positions]\n    I --\x3e K[Update Dimensions]\n    I --\x3e L[Update Rotation]\n    \n    J --\x3e M[Commit Changes]\n    K --\x3e M\n    L --\x3e M\n    \n    M --\x3e N{Valid Result?}\n    N --\x3e|Yes| O[Update Store]\n    N --\x3e|No| P[Revert]\n    \n    O --\x3e Q[Re-render Canvas]\n    P --\x3e Q\n    \n    style C2 fill:#e1f5ff\n    style C3 fill:#e1f5ff\n    style D2 fill:#e1f5ff\n    style O fill:#e1ffe1"}),"\n",(0,s.jsx)(n.h2,{id:"handle-system",children:"Handle System"}),"\n",(0,s.jsx)(n.mermaid,{value:'graph TB\n    subgraph "Transform Handles"\n        BB[Bounding Box]\n        BB --\x3e TL[Top-Left Corner]\n        BB --\x3e TR[Top-Right Corner]\n        BB --\x3e BL[Bottom-Left Corner]\n        BB --\x3e BR[Bottom-Right Corner]\n        BB --\x3e T[Top Edge]\n        BB --\x3e B[Bottom Edge]\n        BB --\x3e L[Left Edge]\n        BB --\x3e R[Right Edge]\n        BB --\x3e ROT[Rotation Handle]\n    end\n    \n    subgraph "Handle Behaviors"\n        TL --\x3e SCALE1[Diagonal Scale]\n        TR --\x3e SCALE2[Diagonal Scale]\n        BL --\x3e SCALE3[Diagonal Scale]\n        BR --\x3e SCALE4[Diagonal Scale]\n        T --\x3e VSCALE1[Vertical Scale]\n        B --\x3e VSCALE2[Vertical Scale]\n        L --\x3e HSCALE1[Horizontal Scale]\n        R --\x3e HSCALE2[Horizontal Scale]\n        ROT --\x3e ROTATE[Rotate Around Center]\n    end\n    \n    subgraph "Transform State"\n        TS[Transform Slice]\n        TS --\x3e AH[activeHandle: string]\n        TS --\x3e IB[initialBounds: Rect]\n        TS --\x3e CB[currentBounds: Rect]\n        TS --\x3e MK[modifierKeys: Set]\n        TS --\x3e CP[centerPoint: Point]\n    end\n    \n    BB --\x3e TS\n    SCALE1 --\x3e TS\n    ROTATE --\x3e TS'}),"\n",(0,s.jsx)(n.h2,{id:"handler",children:"Handler"}),"\n",(0,s.jsx)(n.p,{children:"N/A (uses direct manipulation of handles)"}),"\n",(0,s.jsx)(n.h2,{id:"keyboard-shortcuts",children:"Keyboard Shortcuts"}),"\n",(0,s.jsx)(n.p,{children:"No plugin-specific shortcuts."}),"\n",(0,s.jsx)(n.h2,{id:"ui-contributions",children:"UI Contributions"}),"\n",(0,s.jsx)(n.h3,{id:"panels",children:"Panels"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Transform options, rulers, coordinates"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"overlays",children:"Overlays"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"TransformationOverlay"}),": Visual rendering of transformation handles, bounding box, and real-time transform feedback"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"canvas-layers",children:"Canvas Layers"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Transform handles and bounding box"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"public-apis",children:"Public APIs"}),"\n",(0,s.jsx)(n.p,{children:"No public APIs exposed."}),"\n",(0,s.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Activate the plugin\nconst state = useCanvasStore.getState();\nstate.setMode('transformation');\n\n// Access plugin state\nconst transformationState = useCanvasStore(state => state.transformation);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"implementation-details",children:"Implementation Details"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Location"}),": ",(0,s.jsx)(n.code,{children:"src/plugins/transformation/"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Files"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"index.ts"}),": Plugin definition"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"slice.ts"}),": Zustand slice (if applicable)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"*Panel.tsx"}),": UI panels (if applicable)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"*Overlay.tsx"}),": Overlays (if applicable)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"edge-cases--limitations",children:"Edge Cases & Limitations"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Implementation-specific constraints"}),"\n",(0,s.jsx)(n.li,{children:"Performance considerations for large datasets"}),"\n",(0,s.jsx)(n.li,{children:"Browser compatibility notes (if any)"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"related",children:"Related"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"../overview",children:"Plugin System Overview"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"../../event-bus/overview",children:"Event Bus"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"../../features/transforms",children:"Transform Feature"})}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>l,x:()=>i});var t=a(6540);const s={},r=t.createContext(s);function l(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);