"use strict";(self.webpackChunkttpe_docs=self.webpackChunkttpe_docs||[]).push([[6327],{587:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"plugins/configuration","title":"Plugin Configuration","description":"Advanced configuration options for plugins, including settings persistence, versioning, and security.","source":"@site/docs/plugins/configuration.md","sourceDirName":"plugins","slug":"/plugins/configuration","permalink":"/ttpe/docs/docs/plugins/configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/ekrsulov/ttpe/tree/main/doc/docs/plugins/configuration.md","tags":[],"version":"current","lastUpdatedBy":"Ernesto Krsulovic","lastUpdatedAt":1762144584000,"frontMatter":{"id":"configuration","title":"Plugin Configuration","sidebar_label":"Configuration"},"sidebar":"docs","previous":{"title":"Registration","permalink":"/ttpe/docs/docs/plugins/registration"},"next":{"title":"Select","permalink":"/ttpe/docs/docs/plugins/catalog/select"}}');var s=t(4848),r=t(8453);const a={id:"configuration",title:"Plugin Configuration",sidebar_label:"Configuration"},l="Plugin Configuration",o={},c=[{value:"Plugin Settings Pattern",id:"plugin-settings-pattern",level:2},{value:"Persistence",id:"persistence",level:2},{value:"Versioning",id:"versioning",level:2},{value:"Plugin Version Field (Optional)",id:"plugin-version-field-optional",level:3},{value:"State Migration",id:"state-migration",level:3},{value:"Security &amp; Sandboxing",id:"security--sandboxing",level:2},{value:"Current State",id:"current-state",level:3},{value:"Third-Party Plugin Considerations",id:"third-party-plugin-considerations",level:3},{value:"Performance Configuration",id:"performance-configuration",level:2},{value:"Debounce/Throttle Settings",id:"debouncethrottle-settings",level:3},{value:"Memoization",id:"memoization",level:3},{value:"Feature Flags",id:"feature-flags",level:2},{value:"Backward Compatibility",id:"backward-compatibility",level:2},{value:"Deprecation Pattern",id:"deprecation-pattern",level:3},{value:"Version Detection",id:"version-detection",level:3},{value:"Environment-Specific Configuration",id:"environment-specific-configuration",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"plugin-configuration",children:"Plugin Configuration"})}),"\n",(0,s.jsx)(n.p,{children:"Advanced configuration options for plugins, including settings persistence, versioning, and security."}),"\n",(0,s.jsx)(n.h2,{id:"plugin-settings-pattern",children:"Plugin Settings Pattern"}),"\n",(0,s.jsx)(n.p,{children:"Store plugin-specific settings in the plugin's slice:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export interface MyPluginSlice {\n  settings: {\n    threshold: number;\n    enabled: boolean;\n    mode: 'fast' | 'accurate';\n  };\n  updateSettings: (partial: Partial<MyPluginSlice['settings']>) => void;\n}\n\nexport const createMyPluginSlice: PluginSliceFactory = (set) => ({\n  state: {\n    settings: {\n      threshold: 10,\n      enabled: true,\n      mode: 'fast',\n    },\n    updateSettings: (partial) => set((state) => ({\n      settings: { ...state.settings, ...partial },\n    })),\n  },\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"persistence",children:"Persistence"}),"\n",(0,s.jsx)(n.p,{children:"Settings are automatically persisted if included in the base slice's persistence logic:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// In baseSlice.ts\nconst persistedState = localStorage.getItem('ttpe-state');\nif (persistedState) {\n  const parsed = JSON.parse(persistedState);\n  // Plugin slices are included if they were persisted\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"What's persisted"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Plugin slice state (if plugin adds to persistence)"}),"\n",(0,s.jsx)(n.li,{children:"Global settings"}),"\n",(0,s.jsx)(n.li,{children:"User preferences"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Not persisted"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Transient UI state"}),"\n",(0,s.jsx)(n.li,{children:"Event subscriptions"}),"\n",(0,s.jsx)(n.li,{children:"Canvas services state"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"versioning",children:"Versioning"}),"\n",(0,s.jsx)(n.h3,{id:"plugin-version-field-optional",children:"Plugin Version Field (Optional)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export const myPlugin: PluginDefinition = {\n  id: 'my-plugin',\n  version: '1.2.0', // Optional, for documentation\n  metadata: { /* ... */ },\n  // ...\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"state-migration",children:"State Migration"}),"\n",(0,s.jsx)(n.p,{children:"Handle breaking changes in plugin state:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export const createMyPluginSlice: PluginSliceFactory = (set, get, api) => {\n  // Migrate old state if needed\n  const currentState = get() as any;\n  if (currentState.myPlugin && !currentState.myPlugin.version) {\n    // Old version detected, migrate\n    const migratedData = migrateV1ToV2(currentState.myPlugin.data);\n    set({ myPlugin: { data: migratedData, version: 2 } });\n  }\n  \n  return {\n    state: {\n      version: 2,\n      data: [],\n      // ...\n    },\n  };\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"security--sandboxing",children:"Security & Sandboxing"}),"\n",(0,s.jsx)(n.h3,{id:"current-state",children:"Current State"}),"\n",(0,s.jsx)(n.p,{children:"All plugins run in the same JavaScript context with full access to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Zustand store"}),"\n",(0,s.jsx)(n.li,{children:"DOM"}),"\n",(0,s.jsx)(n.li,{children:"Window APIs"}),"\n",(0,s.jsx)(n.li,{children:"Other plugin APIs"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Assumption"}),": Only trusted, vetted plugins are included in ",(0,s.jsx)(n.code,{children:"CORE_PLUGINS"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"third-party-plugin-considerations",children:"Third-Party Plugin Considerations"}),"\n",(0,s.jsx)(n.p,{children:"If loading external plugins in the future:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Web Worker Sandboxing"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const worker = new Worker('/plugins/third-party.js');\nworker.postMessage({ type: 'INIT', storeSnapshot });\nworker.onmessage = (event) => {\n  if (event.data.type === 'UPDATE_STATE') {\n    store.setState(event.data.payload);\n  }\n};\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"API Whitelist"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const safeContext: PluginApiContext = {\n  store: {\n    getState: () => pick(store.getState(), ['elements', 'selectedIds']),\n    setState: (state) => {\n      // Validate state before applying\n      if (isValidState(state)) {\n        store.setState(state);\n      }\n    },\n    subscribe: store.subscribe,\n  },\n};\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"CSP Headers"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<meta http-equiv="Content-Security-Policy" \n      content="script-src \'self\' https://trusted-cdn.com;">\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"performance-configuration",children:"Performance Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"debouncethrottle-settings",children:"Debounce/Throttle Settings"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export const createMyPluginSlice: PluginSliceFactory = (set) => {\n  let timeoutId: number | null = null;\n  \n  return {\n    state: {\n      debouncedUpdate: (value: string) => {\n        if (timeoutId !== null) clearTimeout(timeoutId);\n        timeoutId = window.setTimeout(() => {\n          set({ value });\n          timeoutId = null;\n        }, 300);\n      },\n    },\n    cleanup: () => {\n      if (timeoutId !== null) clearTimeout(timeoutId);\n    },\n  };\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"memoization",children:"Memoization"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"canvasLayers: [\n  {\n    id: 'expensive-layer',\n    placement: 'foreground',\n    render: (context) => {\n      // Memoize expensive calculations\n      const computed = useMemo(() => {\n        return expensiveComputation(context.elements);\n      }, [context.elements]);\n      \n      return <g>{/* render using computed */}</g>;\n    },\n  },\n],\n"})}),"\n",(0,s.jsx)(n.h2,{id:"feature-flags",children:"Feature Flags"}),"\n",(0,s.jsx)(n.p,{children:"Conditional plugin features:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export const createMyPluginSlice: PluginSliceFactory = (set, get, api) => ({\n  state: {\n    features: {\n      experimentalMode: false,\n      betaFeature: false,\n    },\n    toggleFeature: (feature: keyof Features) => {\n      set((state) => ({\n        features: { \n          ...state.features, \n          [feature]: !state.features[feature] \n        },\n      }));\n    },\n  },\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"backward-compatibility",children:"Backward Compatibility"}),"\n",(0,s.jsx)(n.p,{children:"When changing plugin APIs:"}),"\n",(0,s.jsx)(n.h3,{id:"deprecation-pattern",children:"Deprecation Pattern"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"createApi: (context) => ({\n  // New method\n  processData: (data: Data[]) => { /* ... */ },\n  \n  // Deprecated method (still works)\n  /** @deprecated Use processData instead */\n  process: (data: Data[]) => {\n    console.warn('process() is deprecated, use processData()');\n    return processData(data);\n  },\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"version-detection",children:"Version Detection"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const api = pluginManager.getPluginApi('other-plugin');\nif (api && 'newMethod' in api) {\n  api.newMethod();\n} else if (api && 'oldMethod' in api) {\n  api.oldMethod();\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"environment-specific-configuration",children:"Environment-Specific Configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const isDev = process.env.NODE_ENV !== 'production';\n\nexport const myPlugin: PluginDefinition = {\n  id: 'my-plugin',\n  metadata: { label: 'My Plugin' },\n  handler: (event, point, target, context) => {\n    if (isDev) {\n      console.log('Debug:', { event, point });\n    }\n    // ... normal handler logic\n  },\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"./catalog/select",children:"Plugin Catalog"})}),": Examples from built-in plugins"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"../event-bus/overview",children:"Event Bus"})}),": Cross-plugin communication"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"../api/create-api",children:"API Reference"})}),": Public API patterns"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>l});var i=t(6540);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);