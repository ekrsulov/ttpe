"use strict";(self.webpackChunkttpe_docs=self.webpackChunkttpe_docs||[]).push([[4170],{6349:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>o});const l=JSON.parse('{"id":"api/plugin-manager","title":"Plugin Manager API","description":"The PluginManager is the central orchestrator of TTPE\'s plugin system. It manages plugin lifecycle, handles plugin registration, provides access to plugin APIs, and coordinates UI components (panels, overlays, actions) across the application.","source":"@site/docs/api/plugin-manager.md","sourceDirName":"api","slug":"/api/plugin-manager","permalink":"/ttpe/docs/api/plugin-manager","draft":false,"unlisted":false,"editUrl":"https://github.com/ekrsulov/ttpe/tree/main/doc/docs/api/plugin-manager.md","tags":[],"version":"current","lastUpdatedBy":"Ernesto Krsulovic","lastUpdatedAt":1762144179000,"frontMatter":{"id":"plugin-manager","title":"Plugin Manager API","sidebar_label":"Plugin Manager"},"sidebar":"docs","previous":{"title":"createApi","permalink":"/ttpe/docs/api/create-api"},"next":{"title":"Canvas Store","permalink":"/ttpe/docs/api/canvas-store"}}');var t=i(4848),s=i(8453);const r={id:"plugin-manager",title:"Plugin Manager API",sidebar_label:"Plugin Manager"},a="Plugin Manager API",c={},o=[{value:"Overview",id:"overview",level:2},{value:"Core Responsibilities",id:"core-responsibilities",level:2},{value:"API Reference",id:"api-reference",level:2},{value:"Plugin Registration",id:"plugin-registration",level:3},{value:"<code>register(plugin: PluginDefinition): void</code>",id:"registerplugin-plugindefinition-void",level:4},{value:"<code>unregister(pluginId: string): void</code>",id:"unregisterpluginid-string-void",level:4},{value:"<code>getPlugin(pluginId: string): PluginDefinition | undefined</code>",id:"getpluginpluginid-string-plugindefinition--undefined",level:4},{value:"<code>getAll(): PluginDefinition[]</code>",id:"getall-plugindefinition",level:4},{value:"<code>hasTool(name: string): boolean</code>",id:"hastoolname-string-boolean",level:4},{value:"API Access",id:"api-access",level:3},{value:"<code>getPluginApi&lt;T&gt;(pluginId: string): T | undefined</code>",id:"getpluginapitpluginid-string-t--undefined",level:4},{value:"<code>callPluginApi(pluginId: string, method: string, ...args: any[]): any</code>",id:"callpluginapipluginid-string-method-string-args-any-any",level:4},{value:"Event Handling",id:"event-handling",level:3},{value:"<code>executeHandler(tool: string, event: string, point: Point, target: EventTarget | null, helpers: any): void</code>",id:"executehandlertool-string-event-string-point-point-target-eventtarget--null-helpers-any-void",level:4},{value:"<code>registerInteractionHandler(pluginId: string, eventType: string, handler: Function): void</code>",id:"registerinteractionhandlerpluginid-string-eventtype-string-handler-function-void",level:4},{value:"Canvas Services",id:"canvas-services",level:3},{value:"<code>registerCanvasService(service: CanvasService): void</code>",id:"registercanvasserviceservice-canvasservice-void",level:4},{value:"<code>activateCanvasService(serviceId: string, context: PluginContext): void</code>",id:"activatecanvasserviceserviceid-string-context-plugincontext-void",level:4},{value:"<code>deactivateCanvasService(serviceId: string): void</code>",id:"deactivatecanvasserviceserviceid-string-void",level:4},{value:"UI Component Queries",id:"ui-component-queries",level:3},{value:"<code>getPanels(toolName: string): PanelDefinition[]</code>",id:"getpanelstoolname-string-paneldefinition",level:4},{value:"<code>getOverlays(toolName: string): OverlayDefinition[]</code>",id:"getoverlaystoolname-string-overlaydefinition",level:4},{value:"<code>getActions(placement: ActionPlacement): ActionDefinition[]</code>",id:"getactionsplacement-actionplacement-actiondefinition",level:4},{value:"<code>getCanvasLayers(): LayerDefinition[]</code>",id:"getcanvaslayers-layerdefinition",level:4},{value:"Advanced Usage",id:"advanced-usage",level:2},{value:"Plugin Hot Reloading",id:"plugin-hot-reloading",level:3},{value:"Conditional Plugin Loading",id:"conditional-plugin-loading",level:3},{value:"Plugin Discovery",id:"plugin-discovery",level:3},{value:"Batch Operations",id:"batch-operations",level:3},{value:"Implementation Details",id:"implementation-details",level:2},{value:"Location",id:"location",level:3},{value:"Singleton Pattern",id:"singleton-pattern",level:3},{value:"Internal Structure",id:"internal-structure",level:3},{value:"Testing",id:"testing",level:2},{value:"Mock Plugin Manager",id:"mock-plugin-manager",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function g(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"plugin-manager-api",children:"Plugin Manager API"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.strong,{children:"PluginManager"})," is the central orchestrator of TTPE's plugin system. It manages plugin lifecycle, handles plugin registration, provides access to plugin APIs, and coordinates UI components (panels, overlays, actions) across the application."]}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"The PluginManager acts as a registry and coordinator for all plugins:"}),"\n",(0,t.jsx)(n.mermaid,{value:'graph TB\n    subgraph "Plugin Manager"\n        PM[PluginManager]\n        Registry[Plugin Registry]\n        APIRegistry[API Registry]\n        UIRegistry[UI Component Registry]\n    end\n    \n    subgraph "Plugins"\n        P1[Pencil Plugin]\n        P2[Select Plugin]\n        P3[Edit Plugin]\n        P4[Shape Plugin]\n    end\n    \n    subgraph "Consumers"\n        Canvas[Canvas Component]\n        Sidebar[Sidebar]\n        Store[Canvas Store]\n        External[External Code]\n    end\n    \n    P1 --\x3e|register| PM\n    P2 --\x3e|register| PM\n    P3 --\x3e|register| PM\n    P4 --\x3e|register| PM\n    \n    PM --\x3e Registry\n    PM --\x3e APIRegistry\n    PM --\x3e UIRegistry\n    \n    Canvas --\x3e|getPanels| PM\n    Canvas --\x3e|getOverlays| PM\n    Sidebar --\x3e|getActions| PM\n    Store --\x3e|executeHandler| PM\n    External --\x3e|getPluginApi| PM\n    \n    style PM fill:#e1f5ff\n    style APIRegistry fill:#c8e6c9'}),"\n",(0,t.jsx)(n.h2,{id:"core-responsibilities",children:"Core Responsibilities"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Plugin Lifecycle"}),": Register, unregister, and track plugins"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"API Management"}),": Store and provide access to plugin APIs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Event Coordination"}),": Execute plugin event handlers"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"UI Orchestration"}),": Collect and provide UI components from plugins"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Service Management"}),": Register and activate canvas services"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,t.jsx)(n.h3,{id:"plugin-registration",children:"Plugin Registration"}),"\n",(0,t.jsx)(n.h4,{id:"registerplugin-plugindefinition-void",children:(0,t.jsx)(n.code,{children:"register(plugin: PluginDefinition): void"})}),"\n",(0,t.jsx)(n.p,{children:"Registers a new plugin with the manager."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { pencilPlugin } from '@/plugins/pencil';\n\npluginManager.register(pencilPlugin);\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Flow"}),":"]}),"\n",(0,t.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Code\n    participant PM as PluginManager\n    participant Registry\n    participant Store\n    \n    Code->>PM: register(plugin)\n    PM->>Registry: Add to registry\n    PM->>PM: createApi(context)\n    PM->>Store: Store API reference\n    PM--\x3e>Code: Registration complete\n    \n    Note over PM: Plugin is now available"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Details"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Validates plugin structure"}),"\n",(0,t.jsxs)(n.li,{children:["Creates plugin API if ",(0,t.jsx)(n.code,{children:"createApi"})," is defined"]}),"\n",(0,t.jsx)(n.li,{children:"Stores plugin in internal registry"}),"\n",(0,t.jsx)(n.li,{children:"Makes plugin available for querying"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"unregisterpluginid-string-void",children:(0,t.jsx)(n.code,{children:"unregister(pluginId: string): void"})}),"\n",(0,t.jsx)(n.p,{children:"Removes a plugin from the manager."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"pluginManager.unregister('pencil');\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Use Cases"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Hot reloading during development"}),"\n",(0,t.jsx)(n.li,{children:"Disabling plugins at runtime"}),"\n",(0,t.jsx)(n.li,{children:"Cleanup during testing"}),"\n"]}),"\n",(0,t.jsxs)(n.admonition,{type:"warning",children:[(0,t.jsx)(n.p,{children:"Unregistering a plugin does NOT automatically:"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Deactivate the plugin if it's currently active"}),"\n",(0,t.jsx)(n.li,{children:"Clean up plugin state in the store"}),"\n",(0,t.jsx)(n.li,{children:"Remove plugin-generated elements"}),"\n"]})]}),"\n",(0,t.jsx)(n.h4,{id:"getpluginpluginid-string-plugindefinition--undefined",children:(0,t.jsx)(n.code,{children:"getPlugin(pluginId: string): PluginDefinition | undefined"})}),"\n",(0,t.jsx)(n.p,{children:"Retrieves a plugin's full definition."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const plugin = pluginManager.getPlugin('pencil');\n\nif (plugin) {\n  console.log(plugin.name);        // \"Pencil\"\n  console.log(plugin.description); // Plugin description\n  console.log(plugin.icon);        // Icon component\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"getall-plugindefinition",children:(0,t.jsx)(n.code,{children:"getAll(): PluginDefinition[]"})}),"\n",(0,t.jsx)(n.p,{children:"Returns all registered plugins."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const allPlugins = pluginManager.getAll();\n\nallPlugins.forEach(plugin => {\n  console.log(`${plugin.id}: ${plugin.name}`);\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Use Cases"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Building plugin selection UI"}),"\n",(0,t.jsx)(n.li,{children:"Debugging/inspection"}),"\n",(0,t.jsx)(n.li,{children:"Analytics"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"hastoolname-string-boolean",children:(0,t.jsx)(n.code,{children:"hasTool(name: string): boolean"})}),"\n",(0,t.jsx)(n.p,{children:"Checks if a plugin with the given ID exists."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"if (pluginManager.hasTool('pencil')) {\n  // Safe to use pencil plugin\n  const api = pluginManager.getPluginApi('pencil');\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"api-access",children:"API Access"}),"\n",(0,t.jsx)(n.h4,{id:"getpluginapitpluginid-string-t--undefined",children:(0,t.jsx)(n.code,{children:"getPluginApi<T>(pluginId: string): T | undefined"})}),"\n",(0,t.jsx)(n.p,{children:"Retrieves a plugin's public API with type safety."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { SubpathPluginAPI } from '@/plugins/subpath';\n\n// Type-safe API access\nconst api = pluginManager.getPluginApi<SubpathPluginAPI>('subpath');\n\nif (api) {\n  api.performPathSimplify();     // \u2713 Type-checked\n  api.performSubPathReverse();   // \u2713 Type-checked\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Type Safety"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Without generic: untyped\nconst api = pluginManager.getPluginApi('subpath');\napi?.doSomething(); // No type checking\n\n// With generic: fully typed\nconst api = pluginManager.getPluginApi<SubpathPluginAPI>('subpath');\napi?.performPathSimplify(); // \u2713 IntelliSense & type checking\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Returns"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The plugin's API object if plugin exists and has ",(0,t.jsx)(n.code,{children:"createApi"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"undefined"})," if plugin doesn't exist or has no API"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"callpluginapipluginid-string-method-string-args-any-any",children:(0,t.jsx)(n.code,{children:"callPluginApi(pluginId: string, method: string, ...args: any[]): any"})}),"\n",(0,t.jsx)(n.p,{children:"Dynamically calls a plugin API method."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Direct call\nconst result = pluginManager.callPluginApi(\n  'gridFill',\n  'fillGridCell',\n  { x: 100, y: 100 }\n);\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Use Cases"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Dynamic plugin interactions"}),"\n",(0,t.jsx)(n.li,{children:"Scripting interfaces"}),"\n",(0,t.jsx)(n.li,{children:"Plugin debugging tools"}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsxs)(n.p,{children:["Prefer ",(0,t.jsx)(n.code,{children:"getPluginApi<T>()"})," for type safety. Only use ",(0,t.jsx)(n.code,{children:"callPluginApi"})," when the method name is truly dynamic."]})}),"\n",(0,t.jsx)(n.h3,{id:"event-handling",children:"Event Handling"}),"\n",(0,t.jsx)(n.h4,{id:"executehandlertool-string-event-string-point-point-target-eventtarget--null-helpers-any-void",children:(0,t.jsx)(n.code,{children:"executeHandler(tool: string, event: string, point: Point, target: EventTarget | null, helpers: any): void"})}),"\n",(0,t.jsx)(n.p,{children:"Executes a plugin's event handler for a specific event type."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"pluginManager.executeHandler(\n  'pencil',\n  'pointerdown',\n  { x: 100, y: 100 },\n  event.target,\n  helpers\n);\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Internal Use"}),": This method is primarily called by the Canvas component when dispatching events to the active plugin."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Handler Resolution"}),":"]}),"\n",(0,t.jsx)(n.mermaid,{value:"graph TD\n    A[executeHandler called] --\x3e B{Plugin exists?}\n    B --\x3e|No| C[Log warning, return]\n    B --\x3e|Yes| D{Has handler for event?}\n    D --\x3e|No| E[No-op, return]\n    D --\x3e|Yes| F[Execute handler]\n    F --\x3e G[Pass payload to handler]\n    G --\x3e H[Handler processes event]\n    \n    style F fill:#c8e6c9\n    style C fill:#ffcdd2\n    style E fill:#fff9c4"}),"\n",(0,t.jsx)(n.h4,{id:"registerinteractionhandlerpluginid-string-eventtype-string-handler-function-void",children:(0,t.jsx)(n.code,{children:"registerInteractionHandler(pluginId: string, eventType: string, handler: Function): void"})}),"\n",(0,t.jsx)(n.p,{children:"Registers an event handler for a plugin."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"pluginManager.registerInteractionHandler(\n  'my-plugin',\n  'pointerdown',\n  (payload) => {\n    console.log('Pointer down at:', payload.point);\n  }\n);\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),": Most plugins define handlers in their plugin definition. This method is for dynamic handler registration."]}),"\n",(0,t.jsx)(n.h3,{id:"canvas-services",children:"Canvas Services"}),"\n",(0,t.jsx)(n.p,{children:"Canvas Services are background utilities that run independently of the active plugin."}),"\n",(0,t.jsx)(n.h4,{id:"registercanvasserviceservice-canvasservice-void",children:(0,t.jsx)(n.code,{children:"registerCanvasService(service: CanvasService): void"})}),"\n",(0,t.jsx)(n.p,{children:"Registers a canvas service."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const gridService: CanvasService = {\n  id: 'grid',\n  activate: (context) => {\n    // Setup grid overlay\n  },\n  deactivate: () => {\n    // Clean up grid\n  },\n};\n\npluginManager.registerCanvasService(gridService);\n"})}),"\n",(0,t.jsx)(n.h4,{id:"activatecanvasserviceserviceid-string-context-plugincontext-void",children:(0,t.jsx)(n.code,{children:"activateCanvasService(serviceId: string, context: PluginContext): void"})}),"\n",(0,t.jsx)(n.p,{children:"Activates a registered canvas service."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"pluginManager.activateCanvasService('grid', {\n  store,\n  eventBus,\n  pluginManager,\n});\n"})}),"\n",(0,t.jsx)(n.h4,{id:"deactivatecanvasserviceserviceid-string-void",children:(0,t.jsx)(n.code,{children:"deactivateCanvasService(serviceId: string): void"})}),"\n",(0,t.jsx)(n.p,{children:"Deactivates an active canvas service."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"pluginManager.deactivateCanvasService('grid');\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Service Lifecycle"}),":"]}),"\n",(0,t.jsx)(n.mermaid,{value:"stateDiagram-v2\n    [*] --\x3e Registered: registerCanvasService()\n    Registered --\x3e Active: activateCanvasService()\n    Active --\x3e Registered: deactivateCanvasService()\n    Registered --\x3e [*]: unregister\n    \n    note right of Active\n        Service is running\n        Receives events\n        Updates UI\n    end note"}),"\n",(0,t.jsx)(n.h3,{id:"ui-component-queries",children:"UI Component Queries"}),"\n",(0,t.jsx)(n.h4,{id:"getpanelstoolname-string-paneldefinition",children:(0,t.jsx)(n.code,{children:"getPanels(toolName: string): PanelDefinition[]"})}),"\n",(0,t.jsx)(n.p,{children:"Returns all panels registered by a plugin."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const panels = pluginManager.getPanels('edit');\n\npanels.forEach(panel => {\n  console.log(panel.id);          // e.g., 'edit-panel'\n  console.log(panel.position);    // 'top' | 'bottom'\n  console.log(panel.render);      // React component\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Usage in Sidebar"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"function Sidebar() {\n  const activePlugin = useCanvasStore(state => state.activePlugin);\n  const panels = activePlugin ? pluginManager.getPanels(activePlugin) : [];\n  \n  return (\n    <div>\n      {panels.map(panel => (\n        <Panel key={panel.id} definition={panel} />\n      ))}\n    </div>\n  );\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"getoverlaystoolname-string-overlaydefinition",children:(0,t.jsx)(n.code,{children:"getOverlays(toolName: string): OverlayDefinition[]"})}),"\n",(0,t.jsx)(n.p,{children:"Returns all overlays registered by a plugin."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const overlays = pluginManager.getOverlays('edit');\n\noverlays.forEach(overlay => {\n  console.log(overlay.id);        // e.g., 'edit-points-overlay'\n  console.log(overlay.render);    // React component\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Overlay Rendering"}),":"]}),"\n",(0,t.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Canvas\n    participant PM as PluginManager\n    participant Plugin\n    participant Overlay\n    \n    Canvas->>PM: getOverlays(activePlugin)\n    PM->>Plugin: Retrieve overlay definitions\n    Plugin--\x3e>PM: Return overlay array\n    PM--\x3e>Canvas: Overlay definitions\n    Canvas->>Overlay: Render each overlay\n    Overlay--\x3e>Canvas: SVG elements\n    \n    Note over Canvas,Overlay: Overlays drawn on top of canvas"}),"\n",(0,t.jsx)(n.h4,{id:"getactionsplacement-actionplacement-actiondefinition",children:(0,t.jsx)(n.code,{children:"getActions(placement: ActionPlacement): ActionDefinition[]"})}),"\n",(0,t.jsx)(n.p,{children:"Returns contextual actions for a specific UI placement."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const bottomActions = pluginManager.getActions('bottom-bar');\n\nbottomActions.forEach(action => {\n  console.log(action.id);         // e.g., 'delete-action'\n  console.log(action.icon);       // Icon component\n  console.log(action.label);      // \"Delete\"\n  console.log(action.onClick);    // Handler function\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Action Placements"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"'top-bar'"}),": Top action bar"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"'bottom-bar'"}),": Bottom action bar"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"'context-menu'"}),": Right-click menu"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"'sidebar'"}),": Sidebar actions"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Dynamic Action Bar"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"function BottomActionBar() {\n  const actions = pluginManager.getActions('bottom-bar');\n  \n  return (\n    <HStack>\n      {actions.map(action => (\n        <ToolbarIconButton\n          key={action.id}\n          icon={action.icon}\n          label={action.label}\n          onClick={action.onClick}\n        />\n      ))}\n    </HStack>\n  );\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"getcanvaslayers-layerdefinition",children:(0,t.jsx)(n.code,{children:"getCanvasLayers(): LayerDefinition[]"})}),"\n",(0,t.jsx)(n.p,{children:"Returns all registered canvas layers from plugins."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const layers = pluginManager.getCanvasLayers();\n\nlayers.forEach(layer => {\n  console.log(layer.id);          // e.g., 'grid-layer'\n  console.log(layer.zIndex);      // Rendering order\n  console.log(layer.render);      // React component\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Layer Rendering Order"}),":"]}),"\n",(0,t.jsx)(n.mermaid,{value:'graph TB\n    subgraph "Canvas Layers (z-index)"\n        L1[Background Layer<br/>z-index: 0]\n        L2[Grid Layer<br/>z-index: 10]\n        L3[Elements Layer<br/>z-index: 100]\n        L4[Overlay Layer<br/>z-index: 200]\n        L5[Cursor Layer<br/>z-index: 300]\n    end\n    \n    L1 --\x3e L2\n    L2 --\x3e L3\n    L3 --\x3e L4\n    L4 --\x3e L5\n    \n    style L3 fill:#c8e6c9'}),"\n",(0,t.jsx)(n.h2,{id:"advanced-usage",children:"Advanced Usage"}),"\n",(0,t.jsx)(n.h3,{id:"plugin-hot-reloading",children:"Plugin Hot Reloading"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Unregister old version\npluginManager.unregister('my-plugin');\n\n// Register new version\nimport { myPlugin } from './my-plugin-v2';\npluginManager.register(myPlugin);\n\n// Reset store state if needed\nconst state = useCanvasStore.getState();\nstate.setMode(null);\nstate.setMode('my-plugin');\n"})}),"\n",(0,t.jsx)(n.h3,{id:"conditional-plugin-loading",children:"Conditional Plugin Loading"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const loadPlugins = () => {\n  const basePlugins = [pencilPlugin, selectPlugin, editPlugin];\n  pluginManager.registerAll(basePlugins);\n  \n  // Load advanced plugins only if feature flag enabled\n  if (features.advancedTools) {\n    pluginManager.register(opticalAlignmentPlugin);\n    pluginManager.register(gridFillPlugin);\n  }\n  \n  // Load experimental plugins in dev mode\n  if (process.env.NODE_ENV === 'development') {\n    pluginManager.register(experimentalPlugin);\n  }\n};\n"})}),"\n",(0,t.jsx)(n.h3,{id:"plugin-discovery",children:"Plugin Discovery"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Find all plugins with a specific capability\nconst pluginsWithAPIs = pluginManager\n  .getAll()\n  .filter(plugin => plugin.createApi !== undefined);\n\nconsole.log('Plugins with public APIs:', pluginsWithAPIs.map(p => p.id));\n\n// Find all drawing tools\nconst drawingTools = pluginManager\n  .getAll()\n  .filter(plugin => plugin.category === 'drawing');\n"})}),"\n",(0,t.jsx)(n.h3,{id:"batch-operations",children:"Batch Operations"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Register multiple plugins\nconst registerAll = (plugins: PluginDefinition[]) => {\n  plugins.forEach(plugin => pluginManager.register(plugin));\n};\n\nregisterAll([pencilPlugin, shapePlugin, textPlugin]);\n\n// Get APIs for multiple plugins\nconst getAPIs = <T>(pluginIds: string[]): (T | undefined)[] => {\n  return pluginIds.map(id => pluginManager.getPluginApi<T>(id));\n};\n\nconst [subpathAPI, gridFillAPI] = getAPIs<any>(['subpath', 'gridFill']);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"implementation-details",children:"Implementation Details"}),"\n",(0,t.jsx)(n.h3,{id:"location",children:"Location"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"File"}),": ",(0,t.jsx)(n.code,{children:"/src/plugins/PluginManager.ts"})]}),"\n",(0,t.jsx)(n.h3,{id:"singleton-pattern",children:"Singleton Pattern"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Global singleton instance\nexport const pluginManager = new PluginManager();\n\n// Usage throughout app\nimport { pluginManager } from '@/plugins/pluginManager';\n"})}),"\n",(0,t.jsx)(n.h3,{id:"internal-structure",children:"Internal Structure"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"class PluginManager {\n  private plugins: Map<string, PluginDefinition> = new Map();\n  private apis: Map<string, any> = new Map();\n  private services: Map<string, CanvasService> = new Map();\n  \n  register(plugin: PluginDefinition): void {\n    this.plugins.set(plugin.id, plugin);\n    \n    if (plugin.createApi) {\n      const api = plugin.createApi(this.getContext());\n      this.apis.set(plugin.id, api);\n    }\n  }\n  \n  getPluginApi<T>(pluginId: string): T | undefined {\n    return this.apis.get(pluginId) as T | undefined;\n  }\n  \n  // ... other methods\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,t.jsx)(n.h3,{id:"mock-plugin-manager",children:"Mock Plugin Manager"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { describe, it, expect, vi } from 'vitest';\n\ndescribe('PluginManager', () => {\n  it('should register and retrieve plugins', () => {\n    const mockPlugin: PluginDefinition = {\n      id: 'test-plugin',\n      name: 'Test Plugin',\n    };\n    \n    pluginManager.register(mockPlugin);\n    \n    const retrieved = pluginManager.getPlugin('test-plugin');\n    expect(retrieved).toEqual(mockPlugin);\n  });\n  \n  it('should create and retrieve plugin APIs', () => {\n    const mockPlugin: PluginDefinition = {\n      id: 'test-plugin',\n      name: 'Test Plugin',\n      createApi: () => ({\n        testMethod: () => 'test result',\n      }),\n    };\n    \n    pluginManager.register(mockPlugin);\n    \n    const api = pluginManager.getPluginApi('test-plugin');\n    expect(api?.testMethod()).toBe('test result');\n  });\n});\n"})}),"\n",(0,t.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"./create-api",children:"createApi Pattern"})}),": How to expose plugin APIs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"./canvas-store",children:"Canvas Store"})}),": Store methods available to plugins"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"../plugins/registration",children:"Plugin Registration"})}),": How to register and configure plugins"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"../plugins/lifecycle",children:"Plugin Lifecycle"})}),": Understanding plugin lifecycle hooks"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(g,{...e})}):g(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>a});var l=i(6540);const t={},s=l.createContext(t);function r(e){const n=l.useContext(s);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);