"use strict";(self.webpackChunkttpe_docs=self.webpackChunkttpe_docs||[]).push([[1816],{2075:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"api/canvas-store","title":"Canvas Store API","description":"The Canvas Store is TTPE\'s centralized state management system built on Zustand. It serves as the single source of truth for all application state, including canvas elements, viewport settings, selection, UI state, and plugin-specific data.","source":"@site/docs/api/canvas-store.md","sourceDirName":"api","slug":"/api/canvas-store","permalink":"/ttpe/docs/api/canvas-store","draft":false,"unlisted":false,"editUrl":"https://github.com/ekrsulov/ttpe/tree/main/doc/docs/api/canvas-store.md","tags":[],"version":"current","lastUpdatedBy":"Ernesto Krsulovic","lastUpdatedAt":1762144179000,"frontMatter":{"id":"canvas-store","title":"Canvas Store API","sidebar_label":"Canvas Store"},"sidebar":"docs","previous":{"title":"Plugin Manager","permalink":"/ttpe/docs/api/plugin-manager"},"next":{"title":"Selection","permalink":"/ttpe/docs/features/selection"}}');var i=t(4848),l=t(8453);const r={id:"canvas-store",title:"Canvas Store API",sidebar_label:"Canvas Store"},a="Canvas Store API",c={},o=[{value:"Why Zustand?",id:"why-zustand",level:2},{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"Store Structure",id:"store-structure",level:2},{value:"Slice-Based Design",id:"slice-based-design",level:3},{value:"Core Architecture",id:"core-architecture",level:2},{value:"State Access Patterns",id:"state-access-patterns",level:3},{value:"React Components (Hooks)",id:"react-components-hooks",level:4},{value:"Non-React Code (Direct Access)",id:"non-react-code-direct-access",level:4},{value:"Subscribing to Changes (Outside React)",id:"subscribing-to-changes-outside-react",level:4},{value:"State Update Flow",id:"state-update-flow",level:3},{value:"Core Slices",id:"core-slices",level:2},{value:"Base Slice",id:"base-slice",level:3},{value:"Viewport Slice",id:"viewport-slice",level:3},{value:"Selection Slice",id:"selection-slice",level:3},{value:"Plugin Slices",id:"plugin-slices",level:2},{value:"Accessing Plugin State",id:"accessing-plugin-state",level:3},{value:"State Persistence",id:"state-persistence",level:2},{value:"Type Definitions",id:"type-definitions",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"State Updates",id:"state-updates",level:3},{value:"Plugin Integration",id:"plugin-integration",level:3},{value:"Performance Considerations",id:"performance-considerations",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Testing",id:"testing",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"canvas-store-api",children:"Canvas Store API"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.strong,{children:"Canvas Store"})," is TTPE's centralized state management system built on Zustand. It serves as the single source of truth for all application state, including canvas elements, viewport settings, selection, UI state, and plugin-specific data."]}),"\n",(0,i.jsx)(n.h2,{id:"why-zustand",children:"Why Zustand?"}),"\n",(0,i.jsx)(n.p,{children:"TTPE uses Zustand instead of Redux or Context API because it provides:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Minimal Boilerplate"}),": No actions, reducers, or complex setup"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Performance"}),": Fine-grained subscriptions prevent unnecessary re-renders"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Developer Experience"}),": Simple API with full TypeScript support"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Middleware Support"}),": Built-in persist and temporal (undo/redo) middleware"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Flexibility"}),": Easy to integrate with React and non-React code"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,i.jsx)(n.mermaid,{value:'graph TB\n    subgraph "Canvas Store"\n        Store[Zustand Store]\n        \n        subgraph "Core Slices"\n            Base[Base Slice<br/>Elements, Settings]\n            Viewport[Viewport Slice<br/>Zoom, Pan]\n            Selection[Selection Slice<br/>selectedIds]\n            UI[UI Slice<br/>Panel State]\n        end\n        \n        subgraph "Plugin Slices"\n            Pencil[Pencil Slice]\n            Edit[Edit Slice]\n            Shape[Shape Slice]\n            PluginN[... More Plugins]\n        end\n        \n        subgraph "Middleware"\n            Persist[Persist<br/>localStorage]\n            Temporal[Temporal<br/>Undo/Redo]\n        end\n    end\n    \n    subgraph "Consumers"\n        Components[React Components]\n        Plugins[Plugin Code]\n        EventHandlers[Event Handlers]\n        APIs[Plugin APIs]\n    end\n    \n    Store --\x3e Base\n    Store --\x3e Viewport\n    Store --\x3e Selection\n    Store --\x3e UI\n    Store --\x3e Pencil\n    Store --\x3e Edit\n    Store --\x3e Shape\n    Store --\x3e PluginN\n    \n    Store --\x3e Persist\n    Store --\x3e Temporal\n    \n    Components --\x3e|useCanvasStore| Store\n    Plugins --\x3e|getState| Store\n    EventHandlers --\x3e|getState| Store\n    APIs --\x3e|getState| Store'}),"\n",(0,i.jsx)(n.h2,{id:"store-structure",children:"Store Structure"}),"\n",(0,i.jsxs)(n.p,{children:["The Canvas Store is composed of multiple ",(0,i.jsx)(n.strong,{children:"slices"}),", each responsible for a specific domain:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface CanvasStore extends \n  BaseSlice,\n  ViewportSlice,\n  SelectionSlice,\n  UISlice,\n  // Dynamic plugin slices\n  PencilPluginSlice,\n  EditPluginSlice,\n  ShapePluginSlice,\n  // ... more plugin slices\n{\n  // All slice methods and state combined\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"slice-based-design",children:"Slice-Based Design"}),"\n",(0,i.jsx)(n.mermaid,{value:"graph LR\n    A[Canvas Store] --\x3e B[Base Slice]\n    A --\x3e C[Viewport Slice]\n    A --\x3e D[Selection Slice]\n    A --\x3e E[UI Slice]\n    A --\x3e F[Plugin Slices]\n    \n    B --\x3e B1[Elements]\n    B --\x3e B2[Settings]\n    B --\x3e B3[Core Actions]\n    \n    C --\x3e C1[zoom]\n    C --\x3e C2[panX/panY]\n    C --\x3e C3[Viewport Actions]\n    \n    D --\x3e D1[selectedIds]\n    D --\x3e D2[Selection Actions]\n    \n    E --\x3e E1[Panel State]\n    E --\x3e E2[UI Actions]\n    \n    F --\x3e F1[Pencil State]\n    F --\x3e F2[Edit State]\n    F --\x3e F3[... More Plugins]\n    \n    style A fill:#e1f5ff\n    style B fill:#fff4e1\n    style C fill:#c8e6c9\n    style D fill:#b3e5fc\n    style E fill:#f8bbd0\n    style F fill:#d1c4e9"}),"\n",(0,i.jsx)(n.p,{children:"Each slice is self-contained and can be developed independently, making the codebase modular and maintainable."}),"\n",(0,i.jsx)(n.h2,{id:"core-architecture",children:"Core Architecture"}),"\n",(0,i.jsx)(n.p,{children:"TTPE uses Zustand for state management with the following key principles:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Slice-based"}),": Each feature area has its own slice with dedicated actions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Immutable updates"}),": All state changes create new state objects"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Plugin integration"}),": Plugins can contribute their own slices to the store"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type-safe"}),": Full TypeScript support with proper type definitions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Middleware"}),": Persistence (localStorage) and temporal (undo/redo) support"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"state-access-patterns",children:"State Access Patterns"}),"\n",(0,i.jsx)(n.h4,{id:"react-components-hooks",children:"React Components (Hooks)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { useCanvasStore } from '@/store/canvasStore';\n\nfunction MyComponent() {\n  // Subscribe to specific state\n  const zoom = useCanvasStore(state => state.viewport.zoom);\n  const selectedIds = useCanvasStore(state => state.selectedIds);\n  \n  // Subscribe to actions\n  const addElement = useCanvasStore(state => state.addElement);\n  \n  return <div>Zoom: {zoom}x</div>;\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"non-react-code-direct-access",children:"Non-React Code (Direct Access)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { useCanvasStore } from '@/store/canvasStore';\n\n// Get current state snapshot\nconst state = useCanvasStore.getState();\n\n// Read state\nconsole.log(state.elements);\n\n// Call actions\nstate.addElement({ type: 'path', d: 'M 0 0 L 100 100' });\nstate.setViewport({ zoom: 2.0 });\n"})}),"\n",(0,i.jsx)(n.h4,{id:"subscribing-to-changes-outside-react",children:"Subscribing to Changes (Outside React)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Subscribe to store changes\nconst unsubscribe = useCanvasStore.subscribe((state) => {\n  console.log('Store updated:', state);\n});\n\n// Cleanup\nunsubscribe();\n"})}),"\n",(0,i.jsx)(n.h3,{id:"state-update-flow",children:"State Update Flow"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Component as React Component\n    participant Store as Canvas Store\n    participant Slice as Slice Action\n    participant Middleware as Middleware\n    participant Subscribers as Subscribers\n    \n    Component->>Store: Call action (e.g., addElement)\n    Store->>Slice: Execute slice logic\n    Slice->>Slice: Create new state\n    Slice->>Middleware: Apply middleware\n    Middleware->>Middleware: Persist to localStorage\n    Middleware->>Middleware: Add to undo history\n    Middleware--\x3e>Store: Return new state\n    Store->>Subscribers: Notify subscribers\n    Subscribers->>Component: Re-render if subscribed"}),"\n",(0,i.jsx)(n.h2,{id:"core-slices",children:"Core Slices"}),"\n",(0,i.jsx)(n.h3,{id:"base-slice",children:"Base Slice"}),"\n",(0,i.jsx)(n.p,{children:"The base slice manages fundamental canvas operations and application settings:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface BaseSlice {\n  // Canvas elements\n  elements: CanvasElement[];\n  \n  // Active tool\n  activePlugin: string | null;\n  \n  // Document name\n  documentName: string;\n  \n  // Panel visibility\n  showFilePanel: boolean;\n  showSettingsPanel: boolean;\n  \n  // Mobile features\n  isVirtualShiftActive: boolean;\n  \n  // Style eyedropper\n  styleEyedropper: {\n    isActive: boolean;\n    copiedStyle: PathData | null;\n  };\n  \n  // Application settings\n  settings: {\n    keyboardMovementPrecision: number;\n    showRenderCountBadges: boolean;\n    showMinimap: boolean;\n    showTooltips: boolean;\n    defaultStrokeColor: string;\n  };\n  \n  // Core actions\n  addElement(element: Omit<CanvasElement, 'id' | 'zIndex'>): string;\n  updateElement(id: string, updates: Partial<CanvasElement>): void;\n  deleteElement(id: string): void;\n  deleteSelectedElements(): void;\n  setActivePlugin(plugin: string | null): void;\n  setMode(mode: string): void;\n  setDocumentName(name: string): void;\n  setShowFilePanel(show: boolean): void;\n  setShowSettingsPanel(show: boolean): void;\n  setVirtualShift(active: boolean): void;\n  toggleVirtualShift(): void;\n  updateSettings(updates: Partial<BaseSlice['settings']>): void;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Methods:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"deleteElement(id)"}),": Removes a single element by ID"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"deleteSelectedElements()"}),": Removes all currently selected elements"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"setMode(pluginId)"}),": Activates a plugin/tool by ID"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"addElement(element)"}),": Adds a new element to the canvas and returns its ID"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"updateElement(id, updates)"}),": Updates an existing element's properties"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note"}),": Selection state (",(0,i.jsx)(n.code,{children:"selectedIds"}),") is managed by SelectionSlice, not BaseSlice."]}),"\n",(0,i.jsx)(n.h3,{id:"viewport-slice",children:"Viewport Slice"}),"\n",(0,i.jsx)(n.p,{children:"Manages canvas pan and zoom with a nested viewport object:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface Viewport {\n  zoom: number;      // Zoom level (1.0 = 100%)\n  panX: number;      // Pan offset X\n  panY: number;      // Pan offset Y\n}\n\ninterface ViewportSlice {\n  // State\n  viewport: Viewport;\n  \n  // Actions\n  setViewport(viewport: Partial<Viewport>): void;\n  pan(deltaX: number, deltaY: number): void;\n  zoom(factor: number, centerX?: number, centerY?: number): void;\n  resetPan(): void;\n  resetZoom(): void;\n  \n  // Selectors\n  selectViewport(): Viewport;\n  selectZoom(): number;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Methods:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"setViewport(viewport)"}),": Updates viewport properties (zoom, panX, panY)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pan(deltaX, deltaY)"}),": Increments pan offset by delta values"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"zoom(factor, centerX?, centerY?)"}),": Multiplies zoom by factor, optionally around a point"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"resetPan()"}),": Resets pan offset to (0, 0)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"resetZoom()"}),": Resets zoom level to 1.0 (100%)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Important"}),": Zoom is multiplicative (not incremental steps), and there are no built-in ",(0,i.jsx)(n.code,{children:"fitToContent()"})," or ",(0,i.jsx)(n.code,{children:"centerOnSelection()"})," methods."]}),"\n",(0,i.jsx)(n.h3,{id:"selection-slice",children:"Selection Slice"}),"\n",(0,i.jsx)(n.p,{children:"Handles element selection and provides utilities for selected elements:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface SelectionSlice {\n  // State\n  selectedIds: string[];\n  \n  // Actions\n  selectElement(id: string, multiSelect?: boolean): void;\n  selectElements(ids: string[]): void;\n  clearSelection(): void;\n  getSelectedElements(): CanvasElement[];\n  getSelectedPathsCount(): number;\n  moveSelectedElements(deltaX: number, deltaY: number): void;\n  updateSelectedPaths(properties: Partial<PathData>): void;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Methods:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"selectElement(id, multiSelect?)"}),": Selects a single element (optionally adding to existing selection)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"selectElements(ids)"}),": Replaces current selection with provided IDs"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"clearSelection()"}),": Clears all selections"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"getSelectedElements()"}),": Returns array of currently selected element objects"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"getSelectedPathsCount()"}),": Returns count of selected path elements"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"moveSelectedElements(deltaX, deltaY)"}),": Translates all selected elements"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"updateSelectedPaths(properties)"}),": Updates PathData properties on selected paths"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Important"}),": There is no ",(0,i.jsx)(n.code,{children:"selectionBounds"})," property calculated automatically. Selection bounds must be computed on-demand when needed. Methods like ",(0,i.jsx)(n.code,{children:"addToSelection"}),", ",(0,i.jsx)(n.code,{children:"removeFromSelection"}),", ",(0,i.jsx)(n.code,{children:"selectAll"}),", ",(0,i.jsx)(n.code,{children:"invertSelection"}),", and ",(0,i.jsx)(n.code,{children:"selectByBounds"})," do not exist in this slice."]}),"\n",(0,i.jsx)(n.h2,{id:"plugin-slices",children:"Plugin Slices"}),"\n",(0,i.jsx)(n.p,{children:"Each plugin can contribute its own slice to the global store. Plugin slices are namespaced by plugin ID and registered dynamically at runtime:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Access plugin state\nconst pencilState = useCanvasStore(state => state.pencil);\nconst gridState = useCanvasStore(state => state.grid);\n\n// Plugin slice example (PencilPluginSlice)\ninterface PencilPluginSlice {\n  pencil: {\n    // Pencil-specific state\n    brushSize: number;\n    brushColor: string;\n    brushOpacity: number;\n    \n    // Actions\n    setBrushSize(size: number): void;\n    setBrushColor(color: string): void;\n    setBrushOpacity(opacity: number): void;\n  };\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Available Plugin Slices"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pencil"})," - Pencil drawing tool state"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"text"})," - Text tool state"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"shape"})," - Shape tool state"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"transformation"})," - Transformation tool state"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"edit"})," - Edit tool state"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"subpath"})," - Subpath editing state"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"opticalAlignment"})," - Optical alignment state"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"curves"})," - Curves tool state"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"guidelines"})," - Guidelines plugin state"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"grid"})," - Grid plugin state"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note"}),": The ",(0,i.jsx)(n.code,{children:"select"})," plugin does not have its own slice. Selection state is managed globally by SelectionSlice."]}),"\n",(0,i.jsx)(n.h3,{id:"accessing-plugin-state",children:"Accessing Plugin State"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { useCanvasStore } from '@/store/canvas';\n\n// Get plugin state (may be undefined if plugin not loaded)\nconst pencilState = useCanvasStore(state => state.pencil);\nconst gridState = useCanvasStore(state => state.grid);\n\n// Safe access with optional chaining\nconst brushSize = useCanvasStore(state => state.pencil?.brushSize);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"state-persistence",children:"State Persistence"}),"\n",(0,i.jsxs)(n.p,{children:["The store uses Zustand's ",(0,i.jsx)(n.code,{children:"persist"})," middleware to automatically save state to localStorage:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Persistence configuration\npersist(\n  temporal(/* ... */),\n  {\n    name: 'canvas-app-state',\n    partialize: (state: CanvasStore) => {\n      // All state is persisted by default\n      return state;\n    }\n  }\n)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Persisted State"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"All elements and their properties"}),"\n",(0,i.jsx)(n.li,{children:"Viewport (zoom, pan)"}),"\n",(0,i.jsx)(n.li,{children:"Plugin-specific state"}),"\n",(0,i.jsx)(n.li,{children:"Application settings"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Temporal Middleware (Undo/Redo)"}),":"]}),"\n",(0,i.jsxs)(n.p,{children:["The store also uses ",(0,i.jsx)(n.code,{children:"zundo"}),"'s temporal middleware for undo/redo functionality:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"temporal(\n  (set, get, api) => ({ /* slices */ }),\n  {\n    limit: 50, // Keep last 50 states\n    partialize: (state) => ({\n      elements: state.elements,\n      selectedIds: state.selectedIds,\n      viewport: state.viewport,\n    }),\n    equality: isDeepEqual,\n    handleSet: debounce(handleSet, 100), // 100ms cool-off period\n  }\n)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note"}),": There is no support for custom ",(0,i.jsx)(n.code,{children:"include"}),"/",(0,i.jsx)(n.code,{children:"exclude"})," lists beyond the ",(0,i.jsx)(n.code,{children:"partialize"})," function."]}),"\n",(0,i.jsx)(n.h2,{id:"type-definitions",children:"Type Definitions"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Base element types\nexport type ElementType = 'path' | 'group';\n\nexport interface CanvasElementBase {\n  id: string;\n  type: ElementType;\n  zIndex: number;\n  parentId?: string | null;\n}\n\nexport interface PathElement extends CanvasElementBase {\n  type: 'path';\n  data: PathData;\n}\n\nexport interface GroupElement extends CanvasElementBase {\n  type: 'group';\n  data: GroupData;\n}\n\nexport type CanvasElement = PathElement | GroupElement;\n\n// Path data structure\nexport interface PathData {\n  subPaths: SubPath[];\n  strokeWidth: number;\n  strokeColor: string;\n  strokeOpacity: number;\n  fillColor: string;\n  fillOpacity: number;\n  strokeLinecap?: 'butt' | 'round' | 'square';\n  strokeLinejoin?: 'miter' | 'round' | 'bevel';\n  fillRule?: 'nonzero' | 'evenodd';\n  strokeDasharray?: string;\n  isPencilPath?: boolean;\n  transform?: {\n    scaleX: number;\n    scaleY: number;\n    rotation: number;\n    translateX: number;\n    translateY: number;\n  };\n}\n\n// Group data structure\nexport interface GroupData {\n  childIds: string[];\n  name: string;\n  isLocked: boolean;\n  isHidden: boolean;\n  isExpanded: boolean;\n  transform: {\n    translateX: number;\n    translateY: number;\n    rotation: number;\n    scaleX: number;\n    scaleY: number;\n  };\n}\n\n// Viewport structure\nexport interface Viewport {\n  zoom: number;\n  panX: number;\n  panY: number;\n}\n\n// Geometric types\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport interface Rect {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Important Notes"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"CanvasElement"})," is a union type, not a flat object with dimensions"]}),"\n",(0,i.jsxs)(n.li,{children:["Specific element data is stored in the ",(0,i.jsx)(n.code,{children:"data"})," property"]}),"\n",(0,i.jsxs)(n.li,{children:["Properties like ",(0,i.jsx)(n.code,{children:"visible"}),", ",(0,i.jsx)(n.code,{children:"locked"}),", ",(0,i.jsx)(n.code,{children:"opacity"}),", ",(0,i.jsx)(n.code,{children:"width"}),", and ",(0,i.jsx)(n.code,{children:"height"})," are NOT at the top level"]}),"\n",(0,i.jsxs)(n.li,{children:["Groups have ",(0,i.jsx)(n.code,{children:"isLocked"})," and ",(0,i.jsx)(n.code,{children:"isHidden"})," in their ",(0,i.jsx)(n.code,{children:"GroupData"})]}),"\n",(0,i.jsxs)(n.li,{children:["Transform data is nested within the element's ",(0,i.jsx)(n.code,{children:"data"})," property"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"state-updates",children:"State Updates"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// \u2705 Good: Immutable updates\nstore.setState(state => ({\n  ...state,\n  elements: state.elements.map(el => \n    el.id === id ? { ...el, x: newX } : el\n  )\n}));\n\n// \u274c Bad: Direct mutation\nstore.setState(state => {\n  state.elements[0].x = newX; // Don't do this\n  return state;\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"plugin-integration",children:"Plugin Integration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Plugins should define their slice interface\ninterface MyPluginSlice {\n  myPluginData: any;\n  setMyPluginData(data: any): void;\n}\n\n// Register with store\nconst useMyPluginSlice = createSlice<MyPluginSlice>((set) => ({\n  myPluginData: null,\n  setMyPluginData: (data) => set({ myPluginData: data })\n}));\n"})}),"\n",(0,i.jsx)(n.h3,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use selector functions to prevent unnecessary re-renders"}),"\n",(0,i.jsx)(n.li,{children:"Avoid storing large objects in state"}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"shallow"})," comparison for complex objects"]}),"\n",(0,i.jsxs)(n.li,{children:["Consider using ",(0,i.jsx)(n.code,{children:"useCallback"})," for event handlers"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,i.jsx)(n.p,{children:"The store includes built-in error boundaries and recovery mechanisms:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Error recovery\ntry {\n  store.getState().addElement(newElement);\n} catch (error) {\n  console.error('Failed to add element:', error);\n  // Recovery logic\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,i.jsx)(n.p,{children:"Store slices can be tested in isolation:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { renderHook } from '@testing-library/react';\nimport { useCanvasStore } from '@/store/canvas';\n\ntest('selection slice', () => {\n  const { result } = renderHook(() => useCanvasStore());\n  \n  act(() => {\n    result.current.addToSelection('element-1');\n  });\n  \n  expect(result.current.selectedIds).toContain('element-1');\n});\n"})})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var s=t(6540);const i={},l=s.createContext(i);function r(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);