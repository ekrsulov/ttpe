"use strict";(self.webpackChunkttpe_docs=self.webpackChunkttpe_docs||[]).push([[1680],{5555:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>g,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"plugins/registration","title":"Plugin Registration","description":"This document details the plugin registration mechanism, discovery patterns, and boot sequence.","source":"@site/docs/plugins/registration.md","sourceDirName":"plugins","slug":"/plugins/registration","permalink":"/ttpe/docs/plugins/registration","draft":false,"unlisted":false,"editUrl":"https://github.com/ekrsulov/ttpe/tree/main/doc/docs/plugins/registration.md","tags":[],"version":"current","lastUpdatedBy":"Ernesto Krsulovic","lastUpdatedAt":1762144179000,"frontMatter":{"id":"registration","title":"Plugin Registration","sidebar_label":"Registration"},"sidebar":"docs","previous":{"title":"Lifecycle","permalink":"/ttpe/docs/plugins/lifecycle"},"next":{"title":"Configuration","permalink":"/ttpe/docs/plugins/configuration"}}');var l=i(4848),r=i(8453);const t={id:"registration",title:"Plugin Registration",sidebar_label:"Registration"},o="Plugin Registration",a={},c=[{value:"Registration Process",id:"registration-process",level:2},{value:"Boot Sequence",id:"boot-sequence",level:3},{value:"Core Plugins Export",id:"core-plugins-export",level:3},{value:"Registration API",id:"registration-api",level:2},{value:"<code>register(plugin: PluginDefinition): void</code>",id:"registerplugin-plugindefinition-void",level:3},{value:"<code>unregister(pluginId: string): void</code>",id:"unregisterpluginid-string-void",level:3},{value:"Discovery Pattern",id:"discovery-pattern",level:2},{value:"Static Discovery",id:"static-discovery",level:3},{value:"Dynamic Discovery (Future)",id:"dynamic-discovery-future",level:3},{value:"Plugin Ordering",id:"plugin-ordering",level:2},{value:"Conditional Registration",id:"conditional-registration",level:2},{value:"Re-registration",id:"re-registration",level:2},{value:"Validation",id:"validation",level:2},{value:"ID Uniqueness",id:"id-uniqueness",level:3},{value:"Required Fields",id:"required-fields",level:3},{value:"Plugin Discovery Tools",id:"plugin-discovery-tools",level:2},{value:"List Registered Plugins",id:"list-registered-plugins",level:3},{value:"Check if Plugin Exists",id:"check-if-plugin-exists",level:3},{value:"Get Plugin Definition",id:"get-plugin-definition",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"plugin-registration",children:"Plugin Registration"})}),"\n",(0,l.jsx)(n.p,{children:"This document details the plugin registration mechanism, discovery patterns, and boot sequence."}),"\n",(0,l.jsx)(n.h2,{id:"registration-process",children:"Registration Process"}),"\n",(0,l.jsx)(n.h3,{id:"boot-sequence",children:"Boot Sequence"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"// main.tsx\nimport { pluginManager } from './utils/pluginManager';\nimport { CORE_PLUGINS } from './plugins';\nimport { canvasStoreApi } from './store/canvasStore';\n\n// 1. Set store API\npluginManager.setStoreApi(canvasStoreApi);\n\n// 2. Register all core plugins\nCORE_PLUGINS.forEach((plugin) => {\n  pluginManager.register(plugin);\n});\n\n// 3. Application ready\n"})}),"\n",(0,l.jsx)(n.h3,{id:"core-plugins-export",children:"Core Plugins Export"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"// src/plugins/index.tsx\nexport const CORE_PLUGINS: PluginDefinition<CanvasStore>[] = [\n  selectPlugin,\n  pencilPlugin,\n  textPlugin,\n  shapePlugin,\n  transformationPlugin,\n  editPlugin,\n  subpathPlugin,\n  curvesPlugin,\n  opticalAlignmentPlugin,\n  guidelinesPlugin,\n  gridPlugin,\n  gridFillPlugin,\n  minimapPlugin,\n];\n"})}),"\n",(0,l.jsx)(n.h2,{id:"registration-api",children:"Registration API"}),"\n",(0,l.jsx)(n.h3,{id:"registerplugin-plugindefinition-void",children:(0,l.jsx)(n.code,{children:"register(plugin: PluginDefinition): void"})}),"\n",(0,l.jsx)(n.p,{children:"Registers a plugin with the system."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"pluginManager.register({\n  id: 'my-plugin',\n  metadata: { label: 'My Plugin' },\n  handler: (event, point, target, context) => {\n    // Handle interactions\n  },\n  slices: [createMySlice],\n  createApi: (context) => ({\n    doSomething: () => { /* ... */ },\n  }),\n});\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Behavior"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"If plugin ID already exists, unregisters old version first"}),"\n",(0,l.jsx)(n.li,{children:"Applies slices immediately if store API is set"}),"\n",(0,l.jsxs)(n.li,{children:["Initializes plugin API if ",(0,l.jsx)(n.code,{children:"createApi"})," provided"]}),"\n",(0,l.jsx)(n.li,{children:"Binds keyboard shortcuts"}),"\n",(0,l.jsx)(n.li,{children:"Subscribes handler to event bus (if event bus available)"}),"\n",(0,l.jsx)(n.li,{children:"Registers canvas layers"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"unregisterpluginid-string-void",children:(0,l.jsx)(n.code,{children:"unregister(pluginId: string): void"})}),"\n",(0,l.jsx)(n.p,{children:"Removes a plugin from the system."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"pluginManager.unregister('my-plugin');\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Behavior"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Removes from registry"}),"\n",(0,l.jsx)(n.li,{children:"Calls slice cleanup functions"}),"\n",(0,l.jsx)(n.li,{children:"Unbinds keyboard shortcuts"}),"\n",(0,l.jsx)(n.li,{children:"Unsubscribes from event bus"}),"\n",(0,l.jsx)(n.li,{children:"Deletes plugin API"}),"\n",(0,l.jsx)(n.li,{children:"Removes canvas layers"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"discovery-pattern",children:"Discovery Pattern"}),"\n",(0,l.jsx)(n.h3,{id:"static-discovery",children:"Static Discovery"}),"\n",(0,l.jsxs)(n.p,{children:["All plugins are explicitly imported and listed in ",(0,l.jsx)(n.code,{children:"CORE_PLUGINS"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"import { pencilPlugin } from './pencil';\nimport { textPlugin } from './text';\n// ... more imports\n\nexport const CORE_PLUGINS = [\n  pencilPlugin,\n  textPlugin,\n  // ... more plugins\n];\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Pros"}),": Type-safe, explicit, tree-shakeable\n",(0,l.jsx)(n.strong,{children:"Cons"}),": Manual maintenance, no dynamic loading"]}),"\n",(0,l.jsx)(n.h3,{id:"dynamic-discovery-future",children:"Dynamic Discovery (Future)"}),"\n",(0,l.jsx)(n.p,{children:"Not currently supported, but could be implemented:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"// Hypothetical dynamic plugin loading\nasync function loadPlugin(url: string): Promise<PluginDefinition> {\n  const module = await import(url);\n  return module.default;\n}\n\nconst externalPlugin = await loadPlugin('/plugins/third-party.js');\npluginManager.register(externalPlugin);\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Security considerations"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Requires sandboxing (Web Workers or iframes)"}),"\n",(0,l.jsx)(n.li,{children:"Need to validate plugin schema"}),"\n",(0,l.jsx)(n.li,{children:"Restrict API access"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"plugin-ordering",children:"Plugin Ordering"}),"\n",(0,l.jsx)(n.p,{children:"Plugins are registered in array order, affecting:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Canvas layer Z-index"}),": Earlier plugins' layers appear below later ones"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Action toolbar order"}),": Actions appear in registration order"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Panel stacking"}),": Multiple panels follow registration order"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"// Earlier plugins render below\nconst CORE_PLUGINS = [\n  gridPlugin,         // Renders first (bottom)\n  guidelinesPlugin,   // Above grid\n  selectPlugin,       // Above guidelines\n  // ...\n];\n"})}),"\n",(0,l.jsx)(n.h2,{id:"conditional-registration",children:"Conditional Registration"}),"\n",(0,l.jsx)(n.p,{children:"Register plugins based on feature flags or user preferences:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"const plugins: PluginDefinition[] = [selectPlugin, pencilPlugin];\n\nif (featureFlags.experimentalCurves) {\n  plugins.push(curvesPlugin);\n}\n\nif (user.preferences.showMinimap) {\n  plugins.push(minimapPlugin);\n}\n\nplugins.forEach(p => pluginManager.register(p));\n"})}),"\n",(0,l.jsx)(n.h2,{id:"re-registration",children:"Re-registration"}),"\n",(0,l.jsx)(n.p,{children:"Re-registering a plugin replaces the old version:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"pluginManager.register(pluginV1);\n// ... time passes\npluginManager.register(pluginV2); // Unregisters v1, registers v2\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Use cases"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Hot module replacement (HMR) in development"}),"\n",(0,l.jsx)(n.li,{children:"A/B testing different plugin implementations"}),"\n",(0,l.jsx)(n.li,{children:"Applying user configuration changes"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"validation",children:"Validation"}),"\n",(0,l.jsx)(n.h3,{id:"id-uniqueness",children:"ID Uniqueness"}),"\n",(0,l.jsx)(n.p,{children:"Plugin IDs must be unique. PluginManager enforces this by unregistering the old version when re-registering."}),"\n",(0,l.jsx)(n.h3,{id:"required-fields",children:"Required Fields"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"interface PluginDefinition {\n  id: string;           // Required\n  metadata: {           // Required\n    label: string;      // Required\n    icon?: React.ComponentType;\n    cursor?: string;\n  };\n  // All other fields optional\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:"TypeScript enforces this at compile time."}),"\n",(0,l.jsx)(n.h2,{id:"plugin-discovery-tools",children:"Plugin Discovery Tools"}),"\n",(0,l.jsx)(n.h3,{id:"list-registered-plugins",children:"List Registered Plugins"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"const allPlugins = pluginManager.getAll();\nconsole.log(allPlugins.map(p => p.id));\n// ['select', 'pencil', 'text', ...]\n"})}),"\n",(0,l.jsx)(n.h3,{id:"check-if-plugin-exists",children:"Check if Plugin Exists"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"const hasText = pluginManager.hasTool('text');\nconsole.log(hasText); // true or false\n"})}),"\n",(0,l.jsx)(n.h3,{id:"get-plugin-definition",children:"Get Plugin Definition"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"const pencil = pluginManager.getPlugin('pencil');\nif (pencil) {\n  console.log(pencil.metadata.label); // \"Pencil\"\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.a,{href:"./configuration",children:"Plugin Configuration"})}),": Advanced options"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.a,{href:"./catalog/select",children:"Plugin Catalog"})}),": Browse built-in plugins"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.a,{href:"../event-bus/overview",children:"Event Bus"})}),": How plugins interact"]}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>o});var s=i(6540);const l={},r=s.createContext(l);function t(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);