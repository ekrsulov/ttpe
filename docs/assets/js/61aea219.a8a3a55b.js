"use strict";(self.webpackChunkttpe_docs=self.webpackChunkttpe_docs||[]).push([[9],{489:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>r,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"plugins/lifecycle","title":"Plugin Lifecycle","description":"Understanding the plugin lifecycle is crucial for managing resources, subscriptions, and state correctly.","source":"@site/docs/plugins/lifecycle.md","sourceDirName":"plugins","slug":"/plugins/lifecycle","permalink":"/ttpe/docs/docs/plugins/lifecycle","draft":false,"unlisted":false,"editUrl":"https://github.com/ekrsulov/ttpe/tree/main/doc/docs/plugins/lifecycle.md","tags":[],"version":"current","lastUpdatedBy":"Ernesto Krsulovic","lastUpdatedAt":1762144584000,"frontMatter":{"id":"lifecycle","title":"Plugin Lifecycle","sidebar_label":"Lifecycle"},"sidebar":"docs","previous":{"title":"Overview","permalink":"/ttpe/docs/docs/plugins/overview"},"next":{"title":"Registration","permalink":"/ttpe/docs/docs/plugins/registration"}}');var s=i(4848),l=i(8453);const r={id:"lifecycle",title:"Plugin Lifecycle",sidebar_label:"Lifecycle"},c="Plugin Lifecycle",a={},o=[{value:"Lifecycle States",id:"lifecycle-states",level:2},{value:"Registration Phase",id:"registration-phase",level:2},{value:"1. Plugin Created",id:"1-plugin-created",level:3},{value:"2. Plugin Registered",id:"2-plugin-registered",level:3},{value:"3. Store API Set",id:"3-store-api-set",level:3},{value:"4. Plugin Inactive",id:"4-plugin-inactive",level:3},{value:"5. Plugin Active",id:"5-plugin-active",level:3},{value:"6. Plugin Unregistered",id:"6-plugin-unregistered",level:3},{value:"Event Bus Integration",id:"event-bus-integration",level:2},{value:"Subscription Lifecycle",id:"subscription-lifecycle",level:3},{value:"Handler Execution Guard",id:"handler-execution-guard",level:3},{value:"Slice Lifecycle",id:"slice-lifecycle",level:2},{value:"Slice Registration",id:"slice-registration",level:3},{value:"Slice Unregistration",id:"slice-unregistration",level:3},{value:"API Lifecycle",id:"api-lifecycle",level:2},{value:"API Initialization",id:"api-initialization",level:3},{value:"API Access",id:"api-access",level:3},{value:"API Cleanup",id:"api-cleanup",level:3},{value:"Shortcut Lifecycle",id:"shortcut-lifecycle",level:2},{value:"Binding",id:"binding",level:3},{value:"Cleanup",id:"cleanup",level:3},{value:"Canvas Service Lifecycle",id:"canvas-service-lifecycle",level:2},{value:"Service Registration",id:"service-registration",level:3},{value:"Service Activation",id:"service-activation",level:3},{value:"Resource Management",id:"resource-management",level:2},{value:"Memory Leaks to Avoid",id:"memory-leaks-to-avoid",level:3},{value:"1. Event Listeners Not Removed",id:"1-event-listeners-not-removed",level:4},{value:"2. Intervals/Timeouts Not Cleared",id:"2-intervalstimeouts-not-cleared",level:4},{value:"3. Subscriptions Not Unsubscribed",id:"3-subscriptions-not-unsubscribed",level:4},{value:"Lifecycle Hooks Pattern",id:"lifecycle-hooks-pattern",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Idempotent Registration",id:"1-idempotent-registration",level:3},{value:"2. Defensive Cleanup",id:"2-defensive-cleanup",level:3},{value:"3. State Reset",id:"3-state-reset",level:3},{value:"4. Avoid Circular Dependencies",id:"4-avoid-circular-dependencies",level:3},{value:"Debugging Lifecycle Issues",id:"debugging-lifecycle-issues",level:2},{value:"Check Registration",id:"check-registration",level:3},{value:"Check Active State",id:"check-active-state",level:3},{value:"Check API Availability",id:"check-api-availability",level:3},{value:"Check Event Subscriptions",id:"check-event-subscriptions",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"plugin-lifecycle",children:"Plugin Lifecycle"})}),"\n",(0,s.jsx)(n.p,{children:"Understanding the plugin lifecycle is crucial for managing resources, subscriptions, and state correctly."}),"\n",(0,s.jsx)(n.h2,{id:"lifecycle-states",children:"Lifecycle States"}),"\n",(0,s.jsx)(n.mermaid,{value:"stateDiagram-v2\n    [*] --\x3e Created: new PluginDefinition\n    Created --\x3e Registered: pluginManager.register()\n    \n    state Registered {\n        [*] --\x3e SlicesApplied: if slices exist\n        [*] --\x3e APIInitialized: if createApi exists\n        [*] --\x3e ShortcutsBound: if keyboardShortcuts exist\n        [*] --\x3e InteractionsBound: if handler exists\n        [*] --\x3e LayersRegistered: if canvasLayers exist\n    }\n    \n    Registered --\x3e Inactive: Initial state\n    Inactive --\x3e Active: setMode(pluginId)\n    Active --\x3e Inactive: setMode(otherPluginId)\n    \n    Active --\x3e Unregistered: unregister()\n    Inactive --\x3e Unregistered: unregister()\n    Registered --\x3e Unregistered: unregister()\n    Unregistered --\x3e [*]"}),"\n",(0,s.jsx)(n.h2,{id:"registration-phase",children:"Registration Phase"}),"\n",(0,s.jsx)(n.h3,{id:"1-plugin-created",children:"1. Plugin Created"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const myPlugin: PluginDefinition = {\n  id: 'my-plugin',\n  metadata: { label: 'My Plugin' },\n  // ... rest of definition\n};\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"State"}),": Definition object exists in memory\n",(0,s.jsx)(n.strong,{children:"Can Execute"}),": No"]}),"\n",(0,s.jsx)(n.h3,{id:"2-plugin-registered",children:"2. Plugin Registered"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"pluginManager.register(myPlugin);\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Actions"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Validate plugin ID is unique"}),"\n",(0,s.jsxs)(n.li,{children:["Store in internal registry ",(0,s.jsx)(n.code,{children:"Map<string, PluginDefinition>"})]}),"\n",(0,s.jsx)(n.li,{children:"Apply slices (if any)"}),"\n",(0,s.jsx)(n.li,{children:"Initialize API (if createApi exists)"}),"\n",(0,s.jsx)(n.li,{children:"Bind keyboard shortcuts"}),"\n",(0,s.jsx)(n.li,{children:"Subscribe to event bus (if handler exists)"}),"\n",(0,s.jsx)(n.li,{children:"Register canvas layers"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"State"}),": Plugin known to system\n",(0,s.jsx)(n.strong,{children:"Can Execute"}),": Partially (APIs work, handlers don't fire yet)"]}),"\n",(0,s.jsx)(n.h3,{id:"3-store-api-set",children:"3. Store API Set"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"pluginManager.setStoreApi(canvasStoreApi);\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Actions"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Re-apply slices for all registered plugins"}),"\n",(0,s.jsx)(n.li,{children:"Re-initialize all plugin APIs"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"State"}),": Plugin fully connected to store\n",(0,s.jsx)(n.strong,{children:"Can Execute"}),": Yes, but handler only fires if plugin is active"]}),"\n",(0,s.jsx)(n.h3,{id:"4-plugin-inactive",children:"4. Plugin Inactive"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const state = useCanvasStore.getState();\n// state.activePlugin !== 'my-plugin'\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Behavior"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Handler does ",(0,s.jsx)(n.strong,{children:"not"})," fire on canvas events"]}),"\n",(0,s.jsxs)(n.li,{children:["Tool-scoped panels are ",(0,s.jsx)(n.strong,{children:"hidden"})]}),"\n",(0,s.jsxs)(n.li,{children:["Tool-scoped overlays are ",(0,s.jsx)(n.strong,{children:"hidden"})]}),"\n",(0,s.jsxs)(n.li,{children:["Tool-scoped shortcuts are ",(0,s.jsx)(n.strong,{children:"inactive"})]}),"\n",(0,s.jsxs)(n.li,{children:["Global contributions (panels, overlays) ",(0,s.jsx)(n.strong,{children:"remain active"})]}),"\n",(0,s.jsxs)(n.li,{children:["Public API ",(0,s.jsx)(n.strong,{children:"remains callable"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"5-plugin-active",children:"5. Plugin Active"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const state = useCanvasStore.getState();\nstate.setMode('my-plugin');\n// state.activePlugin === 'my-plugin'\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Behavior"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Handler ",(0,s.jsx)(n.strong,{children:"fires"})," on canvas pointer events"]}),"\n",(0,s.jsxs)(n.li,{children:["Tool-scoped panels are ",(0,s.jsx)(n.strong,{children:"visible"})]}),"\n",(0,s.jsxs)(n.li,{children:["Tool-scoped overlays are ",(0,s.jsx)(n.strong,{children:"visible"})]}),"\n",(0,s.jsxs)(n.li,{children:["Tool-scoped shortcuts are ",(0,s.jsx)(n.strong,{children:"active"})]}),"\n",(0,s.jsx)(n.li,{children:"Cursor changes to plugin's cursor (if specified)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"6-plugin-unregistered",children:"6. Plugin Unregistered"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"pluginManager.unregister('my-plugin');\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Actions"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Remove from registry"}),"\n",(0,s.jsx)(n.li,{children:"Unregister slices (calls cleanup if defined)"}),"\n",(0,s.jsx)(n.li,{children:"Remove keyboard shortcuts"}),"\n",(0,s.jsx)(n.li,{children:"Unsubscribe from event bus"}),"\n",(0,s.jsx)(n.li,{children:"Remove canvas layers"}),"\n",(0,s.jsx)(n.li,{children:"Delete plugin API"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"State"}),": Plugin removed from system\n",(0,s.jsx)(n.strong,{children:"Can Execute"}),": No"]}),"\n",(0,s.jsx)(n.h2,{id:"event-bus-integration",children:"Event Bus Integration"}),"\n",(0,s.jsx)(n.h3,{id:"subscription-lifecycle",children:"Subscription Lifecycle"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant PM as PluginManager\n    participant EB as Event Bus\n    participant Plugin\n    \n    PM->>EB: register(plugin)\n    Note over EB: Store handler\n    EB--\x3e>PM: unsubscribe function\n    PM->>PM: Store in interactionSubscriptions\n    \n    Note over EB: Time passes, events occur\n    \n    EB->>Plugin: pointerdown event\n    Plugin->>Plugin: Execute handler\n    \n    PM->>EB: unregister(plugin)\n    EB->>EB: Remove handler\n    Note over EB: Handler no longer called"}),"\n",(0,s.jsx)(n.h3,{id:"handler-execution-guard",children:"Handler Execution Guard"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// In PluginManager\nprivate bindPluginInteractions(plugin: PluginDefinition): void {\n  if (!this.eventBus || !plugin.handler) return;\n  \n  const unsubscribe = this.eventBus.subscribe('pointerdown', (payload) => {\n    // Guard: Only execute if this plugin is active\n    if (payload.activePlugin !== plugin.id) return;\n    \n    // Build context\n    const api = this.pluginApis.get(plugin.id) ?? {};\n    const context = {\n      store: this.requireStoreApi(),\n      api,\n      helpers: payload.helpers,\n    };\n    \n    // Execute handler\n    plugin.handler!(payload.event, payload.point, payload.target as Element, context);\n  });\n  \n  this.addInteractionSubscription(plugin.id, unsubscribe);\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"slice-lifecycle",children:"Slice Lifecycle"}),"\n",(0,s.jsx)(n.h3,{id:"slice-registration",children:"Slice Registration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export const registerPluginSlices = (\n  storeApi: CanvasStoreApi,\n  pluginId: string,\n  contributions: CanvasPluginSlice[]\n): void => {\n  if (contributions.length === 0) return;\n  \n  // Unregister old slices if any\n  unregisterPluginSlices(storeApi, pluginId);\n  \n  const cleanups: Array<() => void> = [];\n  \n  contributions.forEach(({ state, cleanup }) => {\n    // Apply state to store\n    cleanups.push(applyPluginSlice(storeApi, state));\n    \n    // Store cleanup function\n    if (cleanup) {\n      cleanups.push(() => cleanup(storeApi.setState, storeApi.getState, storeApi));\n    }\n  });\n  \n  // Store all cleanups\n  pluginSliceCleanups.set(pluginId, cleanups);\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"slice-unregistration",children:"Slice Unregistration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export function unregisterPluginSlices(storeApi: CanvasStoreApi, pluginId: string): void {\n  const cleanups = pluginSliceCleanups.get(pluginId);\n  if (!cleanups) return;\n  \n  // Execute all cleanup functions\n  cleanups.forEach(cleanup => cleanup());\n  \n  // Remove from map\n  pluginSliceCleanups.delete(pluginId);\n  \n  // Note: Slice state remains in store (Zustand doesn't support removal)\n  // Set properties to undefined/null if needed\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"api-lifecycle",children:"API Lifecycle"}),"\n",(0,s.jsx)(n.h3,{id:"api-initialization",children:"API Initialization"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"private initializePluginApi(plugin: PluginDefinition): void {\n  if (!plugin.createApi) {\n    this.pluginApis.delete(plugin.id);\n    return;\n  }\n  \n  const context = this.createPluginApiContext();\n  const api = plugin.createApi(context);\n  \n  this.pluginApis.set(plugin.id, api);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"api-access",children:"API Access"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Direct access\nconst api = pluginManager.getPluginApi<MyAPI>('my-plugin');\nif (api) {\n  api.doSomething();\n}\n\n// Proxied call\nconst result = pluginManager.callPluginApi('my-plugin', 'doSomething', arg1, arg2);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"api-cleanup",children:"API Cleanup"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// On unregister\npluginManager.unregister('my-plugin');\n// API is deleted from pluginApis Map\n// Existing references become stale\n"})}),"\n",(0,s.jsx)(n.h2,{id:"shortcut-lifecycle",children:"Shortcut Lifecycle"}),"\n",(0,s.jsx)(n.h3,{id:"binding",children:"Binding"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"private bindPluginShortcuts(plugin: PluginDefinition): void {\n  if (!plugin.keyboardShortcuts) return;\n  \n  const scopedShortcuts: CanvasShortcutMap = {};\n  \n  Object.entries(plugin.keyboardShortcuts).forEach(([key, definition]) => {\n    const normalized = this.normalizeShortcutDefinition(definition);\n    \n    scopedShortcuts[key] = {\n      ...normalized,\n      handler: (event) => {\n        const state = this.requireStoreApi().getState();\n        \n        // Guard: Only execute if plugin is active\n        if (state.activePlugin !== plugin.id) return;\n        \n        const context = this.createPluginApiContext();\n        normalized.handler(event, context);\n      },\n    };\n  });\n  \n  const unsubscribe = canvasShortcutRegistry.register(\n    `plugin:${plugin.id}`,\n    scopedShortcuts\n  );\n  \n  this.shortcutSubscriptions.set(plugin.id, unsubscribe);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"cleanup",children:"Cleanup"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"private teardownPluginShortcuts(pluginId: string): void {\n  const unsubscribe = this.shortcutSubscriptions.get(pluginId);\n  if (unsubscribe) {\n    unsubscribe();\n    this.shortcutSubscriptions.delete(pluginId);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"canvas-service-lifecycle",children:"Canvas Service Lifecycle"}),"\n",(0,s.jsx)(n.p,{children:"Canvas services are independent of plugins but managed by PluginManager:"}),"\n",(0,s.jsx)(n.h3,{id:"service-registration",children:"Service Registration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"pluginManager.registerCanvasService({\n  id: 'my-service',\n  create: (context) => {\n    // Setup\n    const listener = (e: PointerEvent) => { /* ... */ };\n    context.svg.addEventListener('pointermove', listener);\n    \n    return {\n      update: (state) => {\n        // Handle state updates\n      },\n      dispose: () => {\n        // Cleanup\n        context.svg.removeEventListener('pointermove', listener);\n      },\n    };\n  },\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"service-activation",children:"Service Activation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const context: CanvasServiceContext = {\n  svg,\n  controller,\n  eventBus,\n  store: canvasStoreApi,\n};\n\nconst unsubscribe = pluginManager.activateCanvasService('my-service', context);\n\n// Later...\nunsubscribe(); // Calls dispose()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"resource-management",children:"Resource Management"}),"\n",(0,s.jsx)(n.h3,{id:"memory-leaks-to-avoid",children:"Memory Leaks to Avoid"}),"\n",(0,s.jsx)(n.h4,{id:"1-event-listeners-not-removed",children:"1. Event Listeners Not Removed"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// \u274c Memory leak\nhandler: (event, point, target, context) => {\n  window.addEventListener('resize', () => { /* ... */ });\n  // Never removed!\n};\n\n// \u2705 Proper cleanup\nslices: [\n  (set, get, api) => {\n    let resizeHandler: (() => void) | null = null;\n    \n    return {\n      state: {\n        setupListener: () => {\n          resizeHandler = () => { /* ... */ };\n          window.addEventListener('resize', resizeHandler);\n        },\n      },\n      cleanup: () => {\n        if (resizeHandler) {\n          window.removeEventListener('resize', resizeHandler);\n        }\n      },\n    };\n  },\n],\n"})}),"\n",(0,s.jsx)(n.h4,{id:"2-intervalstimeouts-not-cleared",children:"2. Intervals/Timeouts Not Cleared"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// \u274c Memory leak\nlet intervalId: number;\nhandler: () => {\n  intervalId = window.setInterval(() => { /* ... */ }, 1000);\n  // Never cleared!\n};\n\n// \u2705 Proper cleanup\nslices: [\n  (set, get, api) => {\n    let intervalId: number | null = null;\n    \n    return {\n      state: {\n        startPolling: () => {\n          intervalId = window.setInterval(() => { /* ... */ }, 1000);\n        },\n      },\n      cleanup: () => {\n        if (intervalId !== null) {\n          window.clearInterval(intervalId);\n        }\n      },\n    };\n  },\n],\n"})}),"\n",(0,s.jsx)(n.h4,{id:"3-subscriptions-not-unsubscribed",children:"3. Subscriptions Not Unsubscribed"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// \u274c Memory leak\nhandler: (event, point, target, context) => {\n  context.store.subscribe((state) => {\n    console.log(state);\n    // Subscription never removed!\n  });\n};\n\n// \u2705 Proper cleanup\nslices: [\n  (set, get, api) => {\n    let unsubscribe: (() => void) | null = null;\n    \n    return {\n      state: {\n        setupSubscription: () => {\n          unsubscribe = api.subscribe((state) => {\n            console.log(state);\n          });\n        },\n      },\n      cleanup: () => {\n        unsubscribe?.();\n      },\n    };\n  },\n],\n"})}),"\n",(0,s.jsx)(n.h2,{id:"lifecycle-hooks-pattern",children:"Lifecycle Hooks Pattern"}),"\n",(0,s.jsx)(n.p,{children:"Proposed pattern for future enhancement:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface PluginDefinition {\n  // ... existing properties\n  \n  // Lifecycle hooks\n  onRegister?: (context: PluginContext) => void;\n  onUnregister?: (context: PluginContext) => void;\n  onActivate?: (context: PluginContext) => void;\n  onDeactivate?: (context: PluginContext) => void;\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Current workaround"}),": Use slice cleanup and event bus subscriptions."]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"1-idempotent-registration",children:"1. Idempotent Registration"}),"\n",(0,s.jsx)(n.p,{children:"Plugins should handle multiple register/unregister cycles:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// PluginManager already handles this\npluginManager.register(plugin); // OK\npluginManager.register(plugin); // Unregisters old, registers new\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-defensive-cleanup",children:"2. Defensive Cleanup"}),"\n",(0,s.jsx)(n.p,{children:"Always check before cleanup:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"cleanup: () => {\n  if (listener) removeListener();\n  if (interval) clearInterval(interval);\n  if (unsubscribe) unsubscribe();\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-state-reset",children:"3. State Reset"}),"\n",(0,s.jsx)(n.p,{children:"Reset plugin state in cleanup if needed:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"cleanup: (set) => {\n  set({ myPluginData: [], myPluginSettings: defaultSettings });\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"4-avoid-circular-dependencies",children:"4. Avoid Circular Dependencies"}),"\n",(0,s.jsx)(n.p,{children:"Don't call Plugin A's API from Plugin B's createApi factory:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// \u274c Circular dependency\ncreateApi: (context) => ({\n  init: () => {\n    const otherApi = pluginManager.getPluginApi('other');\n    otherApi?.callMe(); // otherApi might not exist yet!\n  },\n});\n\n// \u2705 Call in handler or action\nhandler: (event, point, target, context) => {\n  const otherApi = pluginManager.getPluginApi('other');\n  otherApi?.callMe(); // Safe, all plugins registered\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"debugging-lifecycle-issues",children:"Debugging Lifecycle Issues"}),"\n",(0,s.jsx)(n.h3,{id:"check-registration",children:"Check Registration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"console.log(pluginManager.hasTool('my-plugin')); // true if registered\nconsole.log(pluginManager.getPlugin('my-plugin')); // Definition or undefined\n"})}),"\n",(0,s.jsx)(n.h3,{id:"check-active-state",children:"Check Active State"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const state = useCanvasStore.getState();\nconsole.log(state.activePlugin); // Current active plugin ID\n"})}),"\n",(0,s.jsx)(n.h3,{id:"check-api-availability",children:"Check API Availability"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const api = pluginManager.getPluginApi('my-plugin');\nconsole.log(api); // API object or undefined\n"})}),"\n",(0,s.jsx)(n.h3,{id:"check-event-subscriptions",children:"Check Event Subscriptions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// In PluginManager (dev mode)\nconsole.log(this.interactionSubscriptions.get('my-plugin'));\n// Set of unsubscribe functions\n"})}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"./registration",children:"Plugin Registration"})}),": How registration works under the hood"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"./configuration",children:"Plugin Configuration"})}),": Advanced configuration options"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"./catalog/select",children:"Plugin Catalog"})}),": Examples from built-in plugins"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>c});var t=i(6540);const s={},l=t.createContext(s);function r(e){const n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);