"use strict";(self.webpackChunkttpe_docs=self.webpackChunkttpe_docs||[]).push([[9741],{3392:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"plugins/catalog/duplicate-on-drag","title":"Duplicate on Drag Plugin","description":"The Duplicate on Drag plugin provides an intuitive way to duplicate elements by holding down the Command (\u2318) key while dragging. This is a common interaction pattern found in many design tools.","source":"@site/docs/plugins/catalog/duplicate-on-drag.md","sourceDirName":"plugins/catalog","slug":"/plugins/catalog/duplicate-on-drag","permalink":"/ttpe/docs/plugins/catalog/duplicate-on-drag","draft":false,"unlisted":false,"editUrl":"https://github.com/ekrsulov/ttpe/tree/main/doc/docs/plugins/catalog/duplicate-on-drag.md","tags":[],"version":"current","lastUpdatedBy":"Ernesto Krsulovic","lastUpdatedAt":1762144179000,"frontMatter":{"id":"duplicate-on-drag","title":"Duplicate on Drag Plugin","sidebar_label":"Duplicate on Drag"},"sidebar":"docs","previous":{"title":"Minimap","permalink":"/ttpe/docs/plugins/catalog/minimap"},"next":{"title":"Overview","permalink":"/ttpe/docs/event-bus/overview"}}');var l=i(4848),r=i(8453);const s={id:"duplicate-on-drag",title:"Duplicate on Drag Plugin",sidebar_label:"Duplicate on Drag"},a="Duplicate on Drag Plugin",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Event-Driven Design",id:"event-driven-design",level:3},{value:"Plugin Structure",id:"plugin-structure",level:3},{value:"Implementation Details",id:"implementation-details",level:2},{value:"Canvas Service",id:"canvas-service",level:3},{value:"Event Flow",id:"event-flow",level:3},{value:"Pointer Down (Initiate Duplicate)",id:"pointer-down-initiate-duplicate",level:4},{value:"Pointer Move (Drag Duplicate)",id:"pointer-move-drag-duplicate",level:4},{value:"Pointer Up (Finalize)",id:"pointer-up-finalize",level:4},{value:"Usage",id:"usage",level:2},{value:"User Workflow",id:"user-workflow",level:3},{value:"Keyboard Shortcuts",id:"keyboard-shortcuts",level:3},{value:"Technical Highlights",id:"technical-highlights",level:2},{value:"Decoupled Architecture",id:"decoupled-architecture",level:3},{value:"State Management",id:"state-management",level:3},{value:"Service Registration",id:"service-registration",level:3},{value:"Benefits",id:"benefits",level:2},{value:"For Users",id:"for-users",level:3},{value:"For Developers",id:"for-developers",level:3},{value:"Limitations",id:"limitations",level:2},{value:"Future Enhancements",id:"future-enhancements",level:2},{value:"Related Documentation",id:"related-documentation",level:2},{value:"Code References",id:"code-references",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"duplicate-on-drag-plugin",children:"Duplicate on Drag Plugin"})}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.strong,{children:"Duplicate on Drag"})," plugin provides an intuitive way to duplicate elements by holding down the Command (\u2318) key while dragging. This is a common interaction pattern found in many design tools."]}),"\n",(0,l.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,l.jsxs)(n.p,{children:["This plugin implements a ",(0,l.jsx)(n.strong,{children:"Canvas Service"})," that listens to pointer events globally, regardless of the active tool. When it detects Command+Click+Drag on a selected element, it:"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Creates a duplicate of the selected element"}),"\n",(0,l.jsx)(n.li,{children:"Selects the new duplicate"}),"\n",(0,l.jsx)(n.li,{children:"Begins dragging the duplicate from the original position"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,l.jsx)(n.h3,{id:"event-driven-design",children:"Event-Driven Design"}),"\n",(0,l.jsxs)(n.p,{children:["The plugin uses the ",(0,l.jsx)(n.strong,{children:"Canvas Service"})," pattern to decouple from the core canvas interaction logic:"]}),"\n",(0,l.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant User\n    participant Canvas\n    participant Service as Duplicate Service\n    participant Store\n    \n    User->>Canvas: Command + Click on element\n    Canvas->>Service: pointerdown event\n    Service->>Service: Detect Command key\n    Service->>Store: Duplicate element\n    Service->>Store: Select duplicate\n    \n    User->>Canvas: Drag mouse\n    Canvas->>Service: pointermove event\n    Service->>Store: Move selected element\n    \n    User->>Canvas: Release mouse\n    Canvas->>Service: pointerup event\n    Service->>Service: Reset state"}),"\n",(0,l.jsx)(n.h3,{id:"plugin-structure",children:"Plugin Structure"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"src/plugins/duplicateOnDrag/\n\u251c\u2500\u2500 index.ts         # Plugin definition and registration\n\u251c\u2500\u2500 service.ts       # Canvas Service implementation\n\u2514\u2500\u2500 slice.ts         # Zustand state slice (optional, for future use)\n"})}),"\n",(0,l.jsx)(n.h2,{id:"implementation-details",children:"Implementation Details"}),"\n",(0,l.jsx)(n.h3,{id:"canvas-service",children:"Canvas Service"}),"\n",(0,l.jsxs)(n.p,{children:["The service registers listeners in the ",(0,l.jsx)(n.strong,{children:"capture phase"})," to intercept events before other handlers:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"svg.addEventListener('pointerdown', handlePointerDown, { capture: true });\nsvg.addEventListener('pointermove', handlePointerMove, { capture: true });\nsvg.addEventListener('pointerup', handlePointerUp, { capture: true });\n"})}),"\n",(0,l.jsx)(n.h3,{id:"event-flow",children:"Event Flow"}),"\n",(0,l.jsx)(n.h4,{id:"pointer-down-initiate-duplicate",children:"Pointer Down (Initiate Duplicate)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"const handlePointerDown = (event: PointerEvent) => {\n  // Only trigger on Command/Meta key + left click\n  if (!event.metaKey || event.button !== 0) return;\n  \n  // Only work when select tool is active\n  if (state.activePlugin !== 'select') return;\n  \n  // Check if clicking on selected element\n  const elementId = targetElement?.getAttribute('data-element-id');\n  if (!elementId || !state.selectedIds.includes(elementId)) return;\n  \n  // Duplicate and select the new element\n  const newElement = { ...element, id: generateUniqueId() };\n  store.addElement(newElement);\n  store.selectElements([newElement.id]);\n  \n  // Prevent default interactions\n  event.preventDefault();\n  event.stopPropagation();\n};\n"})}),"\n",(0,l.jsx)(n.h4,{id:"pointer-move-drag-duplicate",children:"Pointer Move (Drag Duplicate)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"const handlePointerMove = (event: PointerEvent) => {\n  if (!isDuplicating) return;\n  \n  const point = state.screenToCanvas(event.clientX, event.clientY);\n  const deltaX = point.x - startPoint.x;\n  const deltaY = point.y - startPoint.y;\n  \n  // Move the duplicated element\n  store.moveSelectedElements(deltaX, deltaY);\n  startPoint = point;\n};\n"})}),"\n",(0,l.jsx)(n.h4,{id:"pointer-up-finalize",children:"Pointer Up (Finalize)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"const handlePointerUp = () => {\n  if (!isDuplicating) return;\n  \n  // Reset state\n  isDuplicating = false;\n  duplicatedElementId = null;\n  startPoint = null;\n};\n"})}),"\n",(0,l.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,l.jsxs)(n.p,{children:["The plugin is ",(0,l.jsx)(n.strong,{children:"always active"})," and doesn't require switching to a specific tool mode."]}),"\n",(0,l.jsx)(n.h3,{id:"user-workflow",children:"User Workflow"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Select an element"})," with the Select tool"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Hold Command (\u2318)"})," key on Mac (or Ctrl on Windows)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Click and drag"})," the selected element"]}),"\n",(0,l.jsxs)(n.li,{children:["A ",(0,l.jsx)(n.strong,{children:"duplicate is created"})," and moves with the cursor"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Release"})," to place the duplicate"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"keyboard-shortcuts",children:"Keyboard Shortcuts"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u2318 + Drag"})," (Mac) - Duplicate and drag"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Ctrl + Drag"})," (Windows/Linux) - Duplicate and drag"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"technical-highlights",children:"Technical Highlights"}),"\n",(0,l.jsx)(n.h3,{id:"decoupled-architecture",children:"Decoupled Architecture"}),"\n",(0,l.jsx)(n.p,{children:"The plugin doesn't modify core canvas code. It uses:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Canvas Service"})," pattern for event listening"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Event Bus"})," architecture for loose coupling"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Capture phase"})," event listeners to intercept before other handlers"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"state-management",children:"State Management"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"export interface DuplicateOnDragPluginSlice {\n  duplicateOnDrag: {\n    isDuplicating: boolean;\n    originalElementId: string | null;\n    duplicatedElementId: string | null;\n    startPoint: { x: number; y: number } | null;\n  };\n  updateDuplicateOnDragState: (state: Partial<...>) => void;\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"service-registration",children:"Service Registration"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"// Register service with plugin manager\npluginManager.registerCanvasService(duplicateOnDragService);\n\n// Activate service in Canvas\nuseDuplicateOnDrag({\n  svgRef,\n  currentMode,\n  screenToCanvas,\n});\n"})}),"\n",(0,l.jsx)(n.h2,{id:"benefits",children:"Benefits"}),"\n",(0,l.jsx)(n.h3,{id:"for-users",children:"For Users"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Intuitive"})," - Familiar interaction from other design tools"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Fast"})," - Quick duplication without menu navigation"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Contextual"})," - Works naturally with selection workflow"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"for-developers",children:"For Developers"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Non-invasive"})," - No core code modifications required"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Extensible"})," - Easy to add similar gesture-based features"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Maintainable"})," - Self-contained service with clear responsibilities"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"limitations",children:"Limitations"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Currently only works in ",(0,l.jsx)(n.strong,{children:"Select mode"})]}),"\n",(0,l.jsxs)(n.li,{children:["Duplicates only ",(0,l.jsx)(n.strong,{children:"single selected elements"})," (not multi-selection yet)"]}),"\n",(0,l.jsx)(n.li,{children:"Command key detection depends on browser event handling"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"future-enhancements",children:"Future Enhancements"}),"\n",(0,l.jsx)(n.p,{children:"Possible improvements:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Multi-selection support"})," - Duplicate groups of elements"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Modifier variations"})," - Different behaviors with Shift, Alt, etc."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Visual feedback"})," - Show duplicate preview before dropping"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Smart positioning"})," - Snap to grid or guides while dragging"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"../../architecture/overview",children:"Architecture Overview"})," - System design patterns"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"../../event-bus/overview",children:"Event Bus"})," - Event-driven architecture"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"../overview",children:"Plugin System"})," - Plugin development guide"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"./select",children:"Select Plugin"})," - Selection handling"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"code-references",children:"Code References"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Plugin Definition"}),": ",(0,l.jsx)(n.code,{children:"src/plugins/duplicateOnDrag/index.ts"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Service Implementation"}),": ",(0,l.jsx)(n.code,{children:"src/plugins/duplicateOnDrag/service.ts"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"State Slice"}),": ",(0,l.jsx)(n.code,{children:"src/plugins/duplicateOnDrag/slice.ts"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Hook Integration"}),": ",(0,l.jsx)(n.code,{children:"src/canvas/hooks/useDuplicateOnDrag.ts"})]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>a});var t=i(6540);const l={},r=t.createContext(l);function s(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);